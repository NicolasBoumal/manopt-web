<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of productmanifold</title>
  <meta name="keywords" content="productmanifold">
  <meta name="description" content="Returns a structure describing a product manifold M = M1 x M2 x ... x Mn.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="#">manopt</a> &gt; <a href="index.html">tools</a> &gt; productmanifold.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for manopt\tools&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>productmanifold
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>Returns a structure describing a product manifold M = M1 x M2 x ... x Mn.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function M = productmanifold(elements) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> Returns a structure describing a product manifold M = M1 x M2 x ... x Mn.

 function M = productmanifold(elements)

 Input: an elements structure such that each field contains a manifold
 structure.
 
 Output: a manifold structure M representing the manifold obtained by
 taking the Cartesian product of the manifolds described in the elements
 structure, with the metric obtainded by element-wise extension. Points
 and vectors are stored as structures with the same fieldnames as in
 elements.

 Example:
 M = productmanifold(struct('X', spherefactory(3), 'Y', spherefactory(4)))
 disp(M.name());
 x = M.rand()

 Points of M = S^2 x S^3 are represented as structures with two fields, X
 and Y. The values associated to X are points of S^2, and likewise points
 of S^3 for the field Y. Tangent vectors are also represented as
 structures with two corresponding fields X and Y.
 
 See also: <a href="powermanifold.html" class="code" title="function Mn = powermanifold(M, n)">powermanifold</a></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="hashmd5.html" class="code" title="function h = hashmd5(inp)">hashmd5</a>	Computes the MD5 hash of input data.</li><li><a href="lincomb.html" class="code" title="function vec = lincomb(M, x, vecs, coeffs)">lincomb</a>	Computes a linear combination of tangent vectors in the Manopt framework.</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../../examples/generalized_procrustes.html" class="code" title="function [A, R] = generalized_procrustes(A_measure)">generalized_procrustes</a>	Rotationally align clouds of points (generalized Procrustes problem)</li><li><a href="../../examples/truncated_svd.html" class="code" title="function [U, S, V, info] = truncated_svd(A, p)">truncated_svd</a>	Returns an SVD decomposition of A truncated to rank p.</li><li><a href="../../manopt/manifolds/specialeuclidean/specialeuclideanfactory.html" class="code" title="function M = specialeuclideanfactory(n, k)">specialeuclideanfactory</a>	Returns a manifold structure to optimize over the special Euclidean group</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function str = name()</a></li><li><a href="#_sub2" class="code">function d = dim()</a></li><li><a href="#_sub3" class="code">function val = inner(x, u, v)</a></li><li><a href="#_sub4" class="code">function d = dist(x, y)</a></li><li><a href="#_sub5" class="code">function d = typicaldist</a></li><li><a href="#_sub6" class="code">function v = proj(x, u)</a></li><li><a href="#_sub7" class="code">function v = tangent(x, u)</a></li><li><a href="#_sub8" class="code">function v = tangent2ambient(x, u)</a></li><li><a href="#_sub9" class="code">function g = egrad2rgrad(x, g)</a></li><li><a href="#_sub10" class="code">function h = ehess2rhess(x, eg, eh, h)</a></li><li><a href="#_sub11" class="code">function y = exp(x, u, t)</a></li><li><a href="#_sub12" class="code">function y = retr(x, u, t)</a></li><li><a href="#_sub13" class="code">function u = log(x1, x2)</a></li><li><a href="#_sub14" class="code">function str = hash(x)</a></li><li><a href="#_sub15" class="code">function v = lincomb(x, a1, u1, a2, u2)</a></li><li><a href="#_sub16" class="code">function x = rand()</a></li><li><a href="#_sub17" class="code">function u = randvec(x)</a></li><li><a href="#_sub18" class="code">function u = zerovec(x)</a></li><li><a href="#_sub19" class="code">function v = transp(x1, x2, u)</a></li><li><a href="#_sub20" class="code">function y = pairmean(x1, x2)</a></li><li><a href="#_sub21" class="code">function u_vec = vec(x, u_mat)</a></li><li><a href="#_sub22" class="code">function u_mat = mat(x, u_vec)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function M = productmanifold(elements)</a>
0002 <span class="comment">% Returns a structure describing a product manifold M = M1 x M2 x ... x Mn.</span>
0003 <span class="comment">%</span>
0004 <span class="comment">% function M = productmanifold(elements)</span>
0005 <span class="comment">%</span>
0006 <span class="comment">% Input: an elements structure such that each field contains a manifold</span>
0007 <span class="comment">% structure.</span>
0008 <span class="comment">%</span>
0009 <span class="comment">% Output: a manifold structure M representing the manifold obtained by</span>
0010 <span class="comment">% taking the Cartesian product of the manifolds described in the elements</span>
0011 <span class="comment">% structure, with the metric obtainded by element-wise extension. Points</span>
0012 <span class="comment">% and vectors are stored as structures with the same fieldnames as in</span>
0013 <span class="comment">% elements.</span>
0014 <span class="comment">%</span>
0015 <span class="comment">% Example:</span>
0016 <span class="comment">% M = productmanifold(struct('X', spherefactory(3), 'Y', spherefactory(4)))</span>
0017 <span class="comment">% disp(M.name());</span>
0018 <span class="comment">% x = M.rand()</span>
0019 <span class="comment">%</span>
0020 <span class="comment">% Points of M = S^2 x S^3 are represented as structures with two fields, X</span>
0021 <span class="comment">% and Y. The values associated to X are points of S^2, and likewise points</span>
0022 <span class="comment">% of S^3 for the field Y. Tangent vectors are also represented as</span>
0023 <span class="comment">% structures with two corresponding fields X and Y.</span>
0024 <span class="comment">%</span>
0025 <span class="comment">% See also: powermanifold</span>
0026 
0027 <span class="comment">% This file is part of Manopt: www.manopt.org.</span>
0028 <span class="comment">% Original author: Nicolas Boumal, Dec. 30, 2012.</span>
0029 <span class="comment">% Contributors:</span>
0030 <span class="comment">% Change log:</span>
0031 <span class="comment">%   NB, July 4, 2013: Added support for vec, mat, tangent.</span>
0032 <span class="comment">%                     Added support for egrad2rgrad and ehess2rhess.</span>
0033 <span class="comment">%                     Modified hash function to make hash strings shorter.</span>
0034 
0035 
0036     elems = fieldnames(elements);
0037     nelems = numel(elems);
0038     
0039     assert(nelems &gt;= 1, <span class="keyword">...</span>
0040            <span class="string">'elements must be a structure with at least one field.'</span>);
0041     
0042     M.name = @<a href="#_sub1" class="code" title="subfunction str = name()">name</a>;
0043     <a name="_sub1" href="#_subfunctions" class="code">function str = name()</a>
0044         str = <span class="string">'Product manifold: '</span>;
0045         str = [str sprintf(<span class="string">'[%s: %s]'</span>, <span class="keyword">...</span>
0046                            elems{1}, elements.(elems{1}).name())];
0047         <span class="keyword">for</span> i = 2 : nelems
0048             str = [str sprintf(<span class="string">' x [%s: %s]'</span>, <span class="keyword">...</span>
0049                    elems{i}, elements.(elems{i}).name())]; <span class="comment">%#ok&lt;AGROW&gt;</span>
0050         <span class="keyword">end</span>
0051     <span class="keyword">end</span>
0052     
0053     M.dim = @<a href="#_sub2" class="code" title="subfunction d = dim()">dim</a>;
0054     <a name="_sub2" href="#_subfunctions" class="code">function d = dim()</a>
0055         d = 0;
0056         <span class="keyword">for</span> i = 1 : nelems
0057             d = d + elements.(elems{i}).dim();
0058         <span class="keyword">end</span>
0059     <span class="keyword">end</span>
0060     
0061     M.inner = @<a href="#_sub3" class="code" title="subfunction val = inner(x, u, v)">inner</a>;
0062     <a name="_sub3" href="#_subfunctions" class="code">function val = inner(x, u, v)</a>
0063         val = 0;
0064         <span class="keyword">for</span> i = 1 : nelems
0065             val = val + elements.(elems{i}).inner(x.(elems{i}), <span class="keyword">...</span>
0066                                                u.(elems{i}), v.(elems{i}));
0067         <span class="keyword">end</span>
0068     <span class="keyword">end</span>
0069 
0070     M.norm = @(x, d) sqrt(M.inner(x, d, d));
0071 
0072     M.dist = @<a href="#_sub4" class="code" title="subfunction d = dist(x, y)">dist</a>;
0073     <a name="_sub4" href="#_subfunctions" class="code">function d = dist(x, y)</a>
0074         sqd = 0;
0075         <span class="keyword">for</span> i = 1 : nelems
0076             sqd = sqd + elements.(elems{i}).dist(x.(elems{i}), <span class="keyword">...</span>
0077                                                  y.(elems{i}))^2;
0078         <span class="keyword">end</span>
0079         d = sqrt(sqd);
0080     <span class="keyword">end</span>
0081     
0082     M.typicaldist = @<a href="#_sub5" class="code" title="subfunction d = typicaldist">typicaldist</a>;
0083     <a name="_sub5" href="#_subfunctions" class="code">function d = typicaldist</a>
0084         sqd = 0;
0085         <span class="keyword">for</span> i = 1 : nelems
0086             sqd = sqd + elements.(elems{i}).typicaldist()^2;
0087         <span class="keyword">end</span>
0088         d = sqrt(sqd);
0089     <span class="keyword">end</span>
0090 
0091     M.proj = @<a href="#_sub6" class="code" title="subfunction v = proj(x, u)">proj</a>;
0092     <a name="_sub6" href="#_subfunctions" class="code">function v = proj(x, u)</a>
0093         <span class="keyword">for</span> i = 1 : nelems
0094             v.(elems{i}) = elements.(elems{i}).proj(x.(elems{i}), <span class="keyword">...</span>
0095                                                     u.(elems{i}));
0096         <span class="keyword">end</span>
0097     <span class="keyword">end</span>
0098 
0099     M.tangent = @<a href="#_sub7" class="code" title="subfunction v = tangent(x, u)">tangent</a>;
0100     <a name="_sub7" href="#_subfunctions" class="code">function v = tangent(x, u)</a>
0101         <span class="keyword">for</span> i = 1 : nelems
0102             v.(elems{i}) = elements.(elems{i}).tangent(x.(elems{i}), <span class="keyword">...</span>
0103                                                        u.(elems{i}));
0104         <span class="keyword">end</span>
0105     <span class="keyword">end</span>
0106 
0107     M.tangent2ambient = @<a href="#_sub8" class="code" title="subfunction v = tangent2ambient(x, u)">tangent2ambient</a>;
0108     <a name="_sub8" href="#_subfunctions" class="code">function v = tangent2ambient(x, u)</a>
0109         <span class="keyword">for</span> i = 1 : nelems
0110             <span class="keyword">if</span> isfield(elements.(elems{i}), <span class="string">'tangent2ambient'</span>)
0111                 v.(elems{i}) = <span class="keyword">...</span>
0112                     elements.(elems{i}).tangent2ambient( <span class="keyword">...</span>
0113                                                x.(elems{i}), u.(elems{i}));
0114             <span class="keyword">else</span>
0115                 v.(elems{i}) = u.(elems{i});
0116             <span class="keyword">end</span>
0117         <span class="keyword">end</span>
0118     <span class="keyword">end</span>
0119 
0120     M.egrad2rgrad = @<a href="#_sub9" class="code" title="subfunction g = egrad2rgrad(x, g)">egrad2rgrad</a>;
0121     <a name="_sub9" href="#_subfunctions" class="code">function g = egrad2rgrad(x, g)</a>
0122         <span class="keyword">for</span> i = 1 : nelems
0123             g.(elems{i}) = elements.(elems{i}).egrad2rgrad(<span class="keyword">...</span>
0124                                                x.(elems{i}), g.(elems{i}));
0125         <span class="keyword">end</span>
0126     <span class="keyword">end</span>
0127 
0128     M.ehess2rhess = @<a href="#_sub10" class="code" title="subfunction h = ehess2rhess(x, eg, eh, h)">ehess2rhess</a>;
0129     <a name="_sub10" href="#_subfunctions" class="code">function h = ehess2rhess(x, eg, eh, h)</a>
0130         <span class="keyword">for</span> i = 1 : nelems
0131             h.(elems{i}) = elements.(elems{i}).ehess2rhess(<span class="keyword">...</span>
0132                  x.(elems{i}), eg.(elems{i}), eh.(elems{i}), h.(elems{i}));
0133         <span class="keyword">end</span>
0134     <span class="keyword">end</span>
0135     
0136     M.exp = @<a href="#_sub11" class="code" title="subfunction y = exp(x, u, t)">exp</a>;
0137     <a name="_sub11" href="#_subfunctions" class="code">function y = exp(x, u, t)</a>
0138         <span class="keyword">if</span> nargin &lt; 3
0139             t = 1.0;
0140         <span class="keyword">end</span>
0141         <span class="keyword">for</span> i = 1 : nelems
0142             y.(elems{i}) = elements.(elems{i}).exp(x.(elems{i}), <span class="keyword">...</span>
0143                                                    u.(elems{i}), t);
0144         <span class="keyword">end</span>
0145     <span class="keyword">end</span>
0146     
0147     M.retr = @<a href="#_sub12" class="code" title="subfunction y = retr(x, u, t)">retr</a>;
0148     <a name="_sub12" href="#_subfunctions" class="code">function y = retr(x, u, t)</a>
0149         <span class="keyword">if</span> nargin &lt; 3
0150             t = 1.0;
0151         <span class="keyword">end</span>
0152         <span class="keyword">for</span> i = 1 : nelems
0153             y.(elems{i}) = elements.(elems{i}).retr(x.(elems{i}), <span class="keyword">...</span>
0154                                                     u.(elems{i}), t);
0155         <span class="keyword">end</span>
0156     <span class="keyword">end</span>
0157     
0158     M.log = @<a href="#_sub13" class="code" title="subfunction u = log(x1, x2)">log</a>;
0159     <a name="_sub13" href="#_subfunctions" class="code">function u = log(x1, x2)</a>
0160         <span class="keyword">for</span> i = 1 : nelems
0161             u.(elems{i}) = elements.(elems{i}).log(x1.(elems{i}), <span class="keyword">...</span>
0162                                                    x2.(elems{i}));
0163         <span class="keyword">end</span>
0164     <span class="keyword">end</span>
0165 
0166     M.hash = @<a href="#_sub14" class="code" title="subfunction str = hash(x)">hash</a>;
0167     <a name="_sub14" href="#_subfunctions" class="code">function str = hash(x)</a>
0168         str = <span class="string">''</span>;
0169         <span class="keyword">for</span> i = 1 : nelems
0170             str = [str elements.(elems{i}).hash(x.(elems{i}))]; <span class="comment">%#ok&lt;AGROW&gt;</span>
0171         <span class="keyword">end</span>
0172         str = [<span class="string">'z'</span> <a href="hashmd5.html" class="code" title="function h = hashmd5(inp)">hashmd5</a>(str)];
0173     <span class="keyword">end</span>
0174 
0175     M.lincomb = @<a href="lincomb.html" class="code" title="function vec = lincomb(M, x, vecs, coeffs)">lincomb</a>;
0176     <a name="_sub15" href="#_subfunctions" class="code">function v = lincomb(x, a1, u1, a2, u2)</a>
0177         <span class="keyword">if</span> nargin == 3
0178             <span class="keyword">for</span> i = 1 : nelems
0179                 v.(elems{i}) = elements.(elems{i}).lincomb(x.(elems{i}), <span class="keyword">...</span>
0180                                                         a1, u1.(elems{i}));
0181             <span class="keyword">end</span>
0182         <span class="keyword">elseif</span> nargin == 5
0183             <span class="keyword">for</span> i = 1 : nelems
0184                 v.(elems{i}) = elements.(elems{i}).lincomb(x.(elems{i}), <span class="keyword">...</span>
0185                                      a1, u1.(elems{i}), a2, u2.(elems{i}));
0186             <span class="keyword">end</span>
0187         <span class="keyword">else</span>
0188             error(<span class="string">'Bad usage of productmanifold.lincomb'</span>);
0189         <span class="keyword">end</span>
0190     <span class="keyword">end</span>
0191 
0192     M.rand = @<a href="#_sub16" class="code" title="subfunction x = rand()">rand</a>;
0193     <a name="_sub16" href="#_subfunctions" class="code">function x = rand()</a>
0194         <span class="keyword">for</span> i = 1 : nelems
0195             x.(elems{i}) = elements.(elems{i}).rand();
0196         <span class="keyword">end</span>
0197     <span class="keyword">end</span>
0198 
0199     M.randvec = @<a href="#_sub17" class="code" title="subfunction u = randvec(x)">randvec</a>;
0200     <a name="_sub17" href="#_subfunctions" class="code">function u = randvec(x)</a>
0201         <span class="keyword">for</span> i = 1 : nelems
0202             u.(elems{i}) = elements.(elems{i}).randvec(x.(elems{i}));
0203         <span class="keyword">end</span>
0204         u = M.lincomb(x, 1/sqrt(nelems), u);
0205     <span class="keyword">end</span>
0206 
0207     M.zerovec = @<a href="#_sub18" class="code" title="subfunction u = zerovec(x)">zerovec</a>;
0208     <a name="_sub18" href="#_subfunctions" class="code">function u = zerovec(x)</a>
0209         <span class="keyword">for</span> i = 1 : nelems
0210             u.(elems{i}) = elements.(elems{i}).zerovec(x.(elems{i}));
0211         <span class="keyword">end</span>
0212     <span class="keyword">end</span>
0213 
0214     M.transp = @<a href="#_sub19" class="code" title="subfunction v = transp(x1, x2, u)">transp</a>;
0215     <a name="_sub19" href="#_subfunctions" class="code">function v = transp(x1, x2, u)</a>
0216         <span class="keyword">for</span> i = 1 : nelems
0217             v.(elems{i}) = elements.(elems{i}).transp(x1.(elems{i}), <span class="keyword">...</span>
0218                                               x2.(elems{i}), u.(elems{i}));
0219         <span class="keyword">end</span>
0220     <span class="keyword">end</span>
0221 
0222     M.pairmean = @<a href="#_sub20" class="code" title="subfunction y = pairmean(x1, x2)">pairmean</a>;
0223     <a name="_sub20" href="#_subfunctions" class="code">function y = pairmean(x1, x2)</a>
0224         <span class="keyword">for</span> i = 1 : nelems
0225             y.(elems{i}) = elements.(elems{i}).pairmean(x1.(elems{i}), <span class="keyword">...</span>
0226                                                         x2.(elems{i}));
0227         <span class="keyword">end</span>
0228     <span class="keyword">end</span>
0229 
0230 
0231     <span class="comment">% Gather the length of the column vector representations of tangent</span>
0232     <span class="comment">% vectors for each of the manifolds. Raise a flag if any of the base</span>
0233     <span class="comment">% manifolds has no vec function available.</span>
0234     vec_available = true;
0235     vec_lens = zeros(nelems, 1);
0236     <span class="keyword">for</span> ii = 1 : nelems
0237         Mi = elements.(elems{ii});
0238         <span class="keyword">if</span> isfield(Mi, <span class="string">'vec'</span>)
0239             rand_x = Mi.rand();
0240             zero_u = Mi.zerovec(rand_x);
0241             vec_lens(ii) = length(Mi.vec(rand_x, zero_u));
0242         <span class="keyword">else</span>
0243             vec_available = false;
0244             <span class="keyword">break</span>;
0245         <span class="keyword">end</span>
0246     <span class="keyword">end</span>
0247     vec_pos = cumsum([1 ; vec_lens]);
0248     
0249     <span class="keyword">if</span> vec_available
0250         M.vec = @<a href="#_sub21" class="code" title="subfunction u_vec = vec(x, u_mat)">vec</a>;
0251         M.mat = @<a href="#_sub22" class="code" title="subfunction u_mat = mat(x, u_vec)">mat</a>;
0252     <span class="keyword">end</span>
0253     
0254     <a name="_sub21" href="#_subfunctions" class="code">function u_vec = vec(x, u_mat)</a>
0255         u_vec = zeros(vec_pos(end)-1, 1);
0256         <span class="keyword">for</span> i = 1 : nelems
0257             range = vec_pos(i) : (vec_pos(i+1)-1);
0258             u_vec(range) = elements.(elems{i}).vec(x.(elems{i}), <span class="keyword">...</span>
0259                                                    u_mat.(elems{i}));
0260         <span class="keyword">end</span>
0261     <span class="keyword">end</span>
0262 
0263     <a name="_sub22" href="#_subfunctions" class="code">function u_mat = mat(x, u_vec)</a>
0264         u_mat = struct();
0265         <span class="keyword">for</span> i = 1 : nelems
0266             range = vec_pos(i) : (vec_pos(i+1)-1);
0267             u_mat.(elems{i}) = elements.(elems{i}).mat(x.(elems{i}), <span class="keyword">...</span>
0268                                                        u_vec(range));
0269         <span class="keyword">end</span>
0270     <span class="keyword">end</span>
0271 
0272     vecmatareisometries = true;
0273     <span class="keyword">for</span> ii = 1 : nelems
0274         <span class="keyword">if</span> ~isfield(elements.(elems{ii}), <span class="string">'vecmatareisometries'</span>) || <span class="keyword">...</span>
0275            ~elements.(elems{ii}).vecmatareisometries()
0276             vecmatareisometries = false;
0277             <span class="keyword">break</span>;
0278         <span class="keyword">end</span>
0279     <span class="keyword">end</span>
0280     M.vecmatareisometries = @() vecmatareisometries;    
0281 
0282 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Fri 08-Sep-2017 12:43:19 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>