<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of TTeMPS_tangent</title>
  <meta name="keywords" content="TTeMPS_tangent">
  <meta name="description" content="">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../../../index.html">Home</a> &gt;  <a href="#">manopt</a> &gt; <a href="#">manifolds</a> &gt; <a href="../../index.html">ttfixedrank</a> &gt; <a href="../index.html">TTeMPS_1.1</a> &gt; <a href="index.html">@TTeMPS_tangent</a> &gt; TTeMPS_tangent.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../../../index.html"><img alt="<" border="0" src="../../../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for manopt\manifolds\ttfixedrank\TTeMPS_1.1\@TTeMPS_tangent&nbsp;<img alt=">" border="0" src="../../../../../right.png"></a></td></tr></table>-->

<h1>TTeMPS_tangent
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../../../up.png"></a></h2>
<div class="box"><strong></strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../../../up.png"></a></h2>
<div class="box"><strong>This is a script file. </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../../../matlabicon.gif)">
<li><a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS/TTeMPS.html" class="code" title="">TTeMPS</a>	</li><li><a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS/cat.html" class="code" title="function z = cat( mu, x, y )">cat</a>	CAT concatenation of two TT/MPS tensors.</li><li><a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS/contract.html" class="code" title="function res = contract( x, y, idx )">contract</a>	CONTRACT Contraction of two TT/MPS tensors.</li><li><a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS/full.html" class="code" title="function y = full( x )">full</a>	FULL Convert TTeMPS tensor to full array</li><li><a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS/innerprod.html" class="code" title="function res = innerprod( x, y, dir, upto, storeParts )">innerprod</a>	INNERPROD Inner product between two TT/MPS tensors.</li><li><a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS/mtimes.html" class="code" title="function x = mtimes( a, x )">mtimes</a>	MINUS Multiplication of TT/MPS tensor by scalar.</li><li><a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS/plus.html" class="code" title="function z = plus( x, y )">plus</a>	PLUS Addition of two TT/MPS tensors.</li><li><a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS/truncate.html" class="code" title="function x = truncate( x, r )">truncate</a>	TRUNCATE Truncate TTeMPS tensor to prescribed rank.</li><li><a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS_block/full.html" class="code" title="function y = full( x )">full</a>	FULL Convert TTeMPS tensor to full array</li><li><a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS_block/innerprod.html" class="code" title="function res = innerprod( x, y, dir, upto )">innerprod</a>	INNERPROD Inner product between two TT/MPS tensors.</li><li><a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS_block/mtimes.html" class="code" title="function x = mtimes( a, x )">mtimes</a>	MINUS Multiplication of TT/MPS block tensor by scalar or vector</li><li><a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS_block/plus.html" class="code" title="function z = plus( x, y )">plus</a>	PLUS Addition of two TT/MPS block-mu tensors.</li><li><a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS_block/truncate.html" class="code" title="function x = round( x, r )">truncate</a>	ROUND Approximate TTeMPS tensor within a prescribed tolerance.</li><li><a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS_op/contract.html" class="code" title="function res = contract( A, X, mu )">contract</a>	CONTRACT Contraction of two TT/MPS tensors with inner TT/MPS operator.</li><li><a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS_op/full.html" class="code" title="function Afull = full( A )">full</a>	FULL Convert TTeMPS_op operator to full array</li><li><a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS_op/mtimes.html" class="code" title="function A = mtimes( B, A )">mtimes</a>	MINUS Multiplication of TT/MPS operator by scalar.</li><li><a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS_op/plus.html" class="code" title="function z = plus( x, y )">plus</a>	PLUS Addition of two TT/MPS operators.</li><li><a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS_op_laplace/contract.html" class="code" title="function res = contract( A, X, mu )">contract</a>	CONTRACT Contraction of two TT/MPS tensors with inner TT/MPS Laplace operator.</li><li><a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS_op_laplace/mtimes.html" class="code" title="function A = mtimes( B, A )">mtimes</a>	MINUS Multiplication of TT/MPS Laplace operator by scalar.</li><li><a href="TTeMPS_tangent.html" class="code" title="">TTeMPS_tangent</a>	</li><li><a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/tensorprod.html" class="code" title="function res = tensorprod( U, A, mode, apply_inv )">tensorprod</a>	TENSORPROD Tensor-times-Matrix product.</li><li><a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/unfold.html" class="code" title="function W = unfold( U, dir )">unfold</a>	UNFOLD Left/right-unfold a 3D array.</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../../../matlabicon.gif)">
<li><a href="TTeMPS_tangent.html" class="code" title="">TTeMPS_tangent</a>	</li><li><a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS_tangent_orth/TTeMPS_tangent_orth.html" class="code" title="">TTeMPS_tangent_orth</a>	</li><li><a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/algorithms/completion/completion.html" class="code" title="function [X,cost,test] = completion( A_Omega, Omega, A_Gamma, Gamma, X, maxiter, cg )">completion</a>	Completion for Tensor train but without individual orthogonalization</li><li><a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/install_mex.html" class="code" title="">install_mex</a>	Install helper for mex functions</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function Y = TTeMPS_tangent(X, Z, ind, vec)</a></li><li><a href="#_sub2" class="code">function Zfull = full( Z, X )</a></li><li><a href="#_sub3" class="code">function res = plus( X, Y)</a></li><li><a href="#_sub4" class="code">function X = minus( X, Y )</a></li><li><a href="#_sub5" class="code">function X = mtimes( a, X )</a></li><li><a href="#_sub6" class="code">function X = uminus( X )</a></li><li><a href="#_sub7" class="code">function Xnew = tangentAdd( Z, t, X, retract )</a></li><li><a href="#_sub8" class="code">function res = innerprod( Z1, Z2, X )</a></li><li><a href="#_sub9" class="code">function res = at_Omega( Z, ind, X)</a></li><li><a href="#_sub10" class="code">function res = tangent_to_TTeMPS( Z, X)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../../../up.png"></a></h2>
<div class="fragment"><pre>0001 classdef <a href="TTeMPS_tangent.html" class="code" title="">TTeMPS_tangent</a>
0002 <span class="comment">% TTeMPS_tangent</span>
0003 <span class="comment">%</span>
0004 <span class="comment">%   A MATLAB class for representing and tangent tensors</span>
0005 <span class="comment">%   to the TT/MPS format.</span>
0006 <span class="comment">%</span>
0007 
0008 <span class="comment">%   TTeMPS Toolbox.</span>
0009 <span class="comment">%   Michael Steinlechner, 2013-2016</span>
0010 <span class="comment">%   Questions and contact: michael.steinlechner@epfl.ch</span>
0011 <span class="comment">%   BSD 2-clause license, see LICENSE.txt</span>
0012 
0013 
0014 properties( SetAccess = public, GetAccess = public )
0015 
0016     dU
0017     
0018 <span class="keyword">end</span>
0019 
0020 methods( Access = public )
0021 
0022     <a name="_sub0" href="#_subfunctions" class="code">function Y = TTeMPS_tangent(X, Z, ind, vec)</a>
0023     <span class="comment">%TTEMPS_TANGENT projects the d-dimensional array Z into the tangent space at a TT/MPS tensor X.</span>
0024     <span class="comment">%</span>
0025     <span class="comment">%   P = TTEMPS_TANGENT(X) projects the d-dimensional array Z into the tangent space of the</span>
0026     <span class="comment">%    TT-rank-r manifold at a TT/MPS tensor X.</span>
0027     <span class="comment">%</span>
0028     <span class="comment">%   Important: X has to be left-orthogonalized! (use X = orthogonalize(X, X.order) beforehand)</span>
0029     <span class="comment">%</span>
0030         <span class="keyword">if</span> nargin == 1
0031             <span class="comment">% Create a zero tangent tensor</span>
0032             Y.dU = cellfun( @(x) zeros(size(x)), X.U, <span class="string">'UniformOutput'</span>, false );
0033             <span class="keyword">return</span>
0034         <span class="keyword">end</span>
0035 
0036 
0037         <span class="keyword">if</span> ~exist(<span class="string">'ind'</span>,<span class="string">'var'</span>)
0038             sampled = false;
0039         <span class="keyword">else</span>
0040             sampled = true;
0041             <span class="keyword">if</span> ~exist(<span class="string">'vec'</span>,<span class="string">'var'</span>)
0042                 vec = false;
0043             <span class="keyword">end</span>
0044         <span class="keyword">end</span>
0045         
0046         d = X.order;
0047         r = X.rank;
0048         n = X.size;
0049     
0050         invXtX = cell(1,d);
0051         tmp = conj(<a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/unfold.html" class="code" title="function W = unfold( U, dir )">unfold</a>( X.U{d}, <span class="string">'right'</span>)) * <a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/unfold.html" class="code" title="function W = unfold( U, dir )">unfold</a>( X.U{d}, <span class="string">'right'</span>).';
0052         invXtX{d} = pinv(tmp,1e-8);
0053         <span class="keyword">for</span> i = d-1:-1:2     
0054             tmp = <a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/tensorprod.html" class="code" title="function res = tensorprod( U, A, mode, apply_inv )">tensorprod</a>( X.U{i}, tmp', 3);
0055             tmp = conj(<a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/unfold.html" class="code" title="function W = unfold( U, dir )">unfold</a>( tmp, <span class="string">'right'</span>)) * <a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/unfold.html" class="code" title="function W = unfold( U, dir )">unfold</a>( X.U{i}, <span class="string">'right'</span>).';
0056             invXtX{i} = pinv(tmp,1e-8);
0057         <span class="keyword">end</span>
0058 
0059         <span class="keyword">if</span> isa(Z, <span class="string">'TTeMPS'</span>)
0060             
0061             Y.dU = cell(1, d);
0062             
0063             <span class="keyword">for</span> i = 1:d
0064                 Y.dU{i} = <a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS/contract.html" class="code" title="function res = contract( x, y, idx )">contract</a>( X, Z, i);
0065             <span class="keyword">end</span>
0066             
0067             <span class="keyword">for</span> i = 1:d-1
0068                 Y.dU{i} = <a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/unfold.html" class="code" title="function W = unfold( U, dir )">unfold</a>( Y.dU{i}, <span class="string">'left'</span> );
0069                 Y.dU{i} = Y.dU{i} * invXtX{i+1};
0070                 
0071                 <span class="comment">%U = orth(unfold(X.U{i},'left')); % orth unnecessary</span>
0072                 U = <a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/unfold.html" class="code" title="function W = unfold( U, dir )">unfold</a>(X.U{i},<span class="string">'left'</span>);
0073                 Y.dU{i} = Y.dU{i} - U * ( U' * Y.dU{i});
0074                 Y.dU{i} = reshape( Y.dU{i}, [r(i), n(i), r(i+1)] );
0075             <span class="keyword">end</span>
0076             
0077         <span class="keyword">elseif</span> isa(Z, <span class="string">'TTeMPS_tangent'</span>)
0078             
0079             Znew = <a href="#_sub10" class="code" title="subfunction res = tangent_to_TTeMPS( Z, X)">tangent_to_TTeMPS</a>( Z, X );
0080             Y = <a href="TTeMPS_tangent.html" class="code" title="">TTeMPS_tangent</a>( X, Znew );
0081         
0082         <span class="keyword">elseif</span> ~sampled <span class="comment">% Z is a full array</span>
0083             
0084             ZZ = cell(1,d);
0085 
0086             <span class="comment">% right side</span>
0087             ZZ{d} = Z(:);
0088             <span class="keyword">for</span> i = d-1:-1:1
0089                 zz = reshape( Z, [prod(n(1:i)), n(i+1)*r(i+2)] );
0090                 xx = transpose( <a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/unfold.html" class="code" title="function W = unfold( U, dir )">unfold</a>( X.U{i+1}, <span class="string">'right'</span>) );
0091                 Z = zz*xx;
0092                 ZZ{i} = Z * invXtX{i+1};
0093             <span class="keyword">end</span>
0094 
0095             <span class="comment">% left side</span>
0096             <span class="keyword">for</span> k = 2:d
0097                 <span class="keyword">for</span> i = 1:k-1
0098                     Z_i = reshape( ZZ{k}, [r(i)*prod(n(i)), prod(n(i+1:k))*r(k+1)] );
0099                     X_i = <a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/unfold.html" class="code" title="function W = unfold( U, dir )">unfold</a>( X.U{i}, <span class="string">'left'</span>);
0100                     Z = X_i' * Z_i;
0101                     ZZ{k} = Z;
0102                 <span class="keyword">end</span>
0103                 ZZ{k} = reshape( ZZ{k}, [r(k)*n(k), r(k+1)] );
0104             <span class="keyword">end</span>
0105 
0106             Y.dU = cell(1,d);
0107             <span class="comment">% orth. projection (w/o last core)</span>
0108             <span class="keyword">for</span> i = 1:d-1
0109                 U = orth(<a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/unfold.html" class="code" title="function W = unfold( U, dir )">unfold</a>(X.U{i},<span class="string">'left'</span>));
0110                 ZZ{i} = ZZ{i} - U * ( U' * ZZ{i});
0111                 Y.dU{i} = reshape( ZZ{i}, [r(i), n(i), r(i+1)] );
0112             <span class="keyword">end</span>
0113             Y.dU{d} = reshape( ZZ{d}, [r(d), n(d), r(d+1)] );
0114         
0115         <span class="keyword">else</span> <span class="comment">% Z is a sparse array</span>
0116             
0117             vals = Z;
0118             C = cell(1,d);
0119             Y.dU = cell(1,d);
0120             <span class="keyword">for</span> i=1:d
0121                 C{i} = permute( X.U{i}, [1 3 2]);
0122                 <span class="comment">%Y.dU{i} = zeros(size(C{i}));</span>
0123             <span class="keyword">end</span>
0124             res = TTeMPS_tangent_omega( n, r, C, ind.', vals);
0125             
0126             <span class="keyword">for</span> i = 1:d
0127                 res{i} = reshape( res{i}, [r(i), r(i+1), n(i)] );
0128                 Y.dU{i} = <a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/unfold.html" class="code" title="function W = unfold( U, dir )">unfold</a>( permute( res{i}, [1 3 2]), <span class="string">'left'</span>);
0129             <span class="keyword">end</span>
0130             
0131             <span class="keyword">for</span> i=1:d-1
0132                 Y.dU{i} = Y.dU{i} * invXtX{i+1};    
0133             <span class="keyword">end</span>
0134             
0135             <span class="keyword">for</span> i=1:d-1
0136                 <span class="comment">%U = orth(unfold(X.U{i},'left'));</span>
0137                 U = <a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/unfold.html" class="code" title="function W = unfold( U, dir )">unfold</a>(X.U{i},<span class="string">'left'</span>);
0138                 Y.dU{i} = Y.dU{i} - U * ( U' * Y.dU{i});    
0139                 Y.dU{i} = reshape( Y.dU{i}, [r(i), n(i), r(i+1)] );        
0140             <span class="keyword">end</span>
0141             Y.dU{d} = reshape( Y.dU{d}, [r(d), n(d), r(d+1)] );
0142             
0143         <span class="keyword">end</span>
0144     
0145         
0146     <span class="keyword">end</span>
0147     
0148     <a name="_sub1" href="#_subfunctions" class="code">function Zfull = full( Z, X )</a>
0149     <span class="comment">%FULL converts tangent tensor to d-dimensional array</span>
0150     <span class="comment">%</span>
0151     <span class="comment">%   ZFULL = full(Z, X) converts the tangent tensor Z given in factorized form</span>
0152     <span class="comment">%   (class TTeMPS_tangent) to a d-dimensional array ZFULL. X is the TTeMPS tensor at</span>
0153     <span class="comment">%    which point the tangent space is taken.</span>
0154     <span class="comment">%</span>
0155         d = X.order;
0156         
0157         C = cell(1, d);
0158 
0159         C{1} = <a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS/cat.html" class="code" title="function z = cat( mu, x, y )">cat</a>( 3, Z.dU{1}, X.U{1} );
0160         <span class="keyword">for</span> i = 2:d-1
0161             zeroblock = zeros( size(X.U{i}) );
0162             tmp1 = <a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS/cat.html" class="code" title="function z = cat( mu, x, y )">cat</a>( 3, X.U{i}, zeroblock );
0163             tmp2 = <a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS/cat.html" class="code" title="function z = cat( mu, x, y )">cat</a>( 3, Z.dU{i}, X.U{i} );
0164             C{i} = <a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS/cat.html" class="code" title="function z = cat( mu, x, y )">cat</a>( 1, tmp1, tmp2 );
0165         <span class="keyword">end</span>
0166         C{d} = <a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS/cat.html" class="code" title="function z = cat( mu, x, y )">cat</a>( 1, X.U{d}, Z.dU{d} );
0167         
0168         Xnew = <a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS/TTeMPS.html" class="code" title="">TTeMPS</a>( C );
0169         Zfull = <a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS/full.html" class="code" title="function y = full( x )">full</a>( Xnew );
0170     <span class="keyword">end</span>
0171     
0172     <a name="_sub2" href="#_subfunctions" class="code">function res = plus( X, Y)</a>
0173         <span class="comment">%PLUS adds two tangent tensors</span>
0174         <span class="comment">%</span>
0175         <span class="comment">%   RES = plus(X, Y) adds two tangent tensors in factorized form. Both tangent tensors</span>
0176         <span class="comment">%   have be elements of the SAME tangent space.</span>
0177         <span class="comment">%</span>
0178     
0179         res = X;
0180         res.dU = cellfun(@<a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS/plus.html" class="code" title="function z = plus( x, y )">plus</a>, X.dU, Y.dU, <span class="string">'UniformOutput'</span>, false);
0181     <span class="keyword">end</span>
0182     
0183     <a name="_sub3" href="#_subfunctions" class="code">function X = minus( X, Y )</a>
0184         <span class="comment">%MINUS substracts two tangent tensors</span>
0185         <span class="comment">%</span>
0186         <span class="comment">%   RES = minus(X, Y) substracts two tangent tensors in factorized form. Both tangent tensors</span>
0187         <span class="comment">%   have be elements of the SAME tangent space.</span>
0188         <span class="comment">%</span>
0189     
0190         X.dU = cellfun(@<a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS/plus.html" class="code" title="function z = plus( x, y )">plus</a>, X.dU, Y.dU, <span class="string">'UniformOutput'</span>, false);
0191     <span class="keyword">end</span>
0192     
0193     <a name="_sub4" href="#_subfunctions" class="code">function X = mtimes( a, X )</a>
0194         <span class="comment">%MTIMES Multiplication of TTeMPS tangent tensor by scalar</span>
0195         <span class="comment">%</span>
0196         <span class="comment">%   RES = mtimes(a, X) multiplies the TTeMPS tangent tensor X</span>
0197         <span class="comment">%    by the scalar a.</span>
0198         <span class="comment">%</span>
0199         
0200         X.dU = cellfun(@(x) a*x, X.dU, <span class="string">'UniformOutput'</span>, false);    
0201     <span class="keyword">end</span>
0202     <a name="_sub5" href="#_subfunctions" class="code">function X = uminus( X )</a>
0203         <span class="comment">%UMINUS Unary minus of TTeMPS tangent tensor.</span>
0204         <span class="comment">%</span>
0205         <span class="comment">%   RES = uminus(X) negates the TTeMPS tangent tensor X.</span>
0206         <span class="comment">%</span>
0207         
0208         X = <a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS/mtimes.html" class="code" title="function x = mtimes( a, x )">mtimes</a>( -1, X );
0209     <span class="keyword">end</span>
0210     
0211     <a name="_sub6" href="#_subfunctions" class="code">function Xnew = tangentAdd( Z, t, X, retract )</a>
0212     <span class="comment">%TANGENTADD adds a tangent vector to a point on the manifold</span>
0213     <span class="comment">%</span>
0214     <span class="comment">%   RES = tangentAdd(Z, t, X) adds a tangent vector Z to a point X on the rank-r-manifold, scaled by t:</span>
0215     <span class="comment">%             res = X + t*Z</span>
0216     <span class="comment">%     where the result is stored as a TTeMPS tensor of rank 2*r.</span>
0217     <span class="comment">%</span>
0218     <span class="comment">%   RES = tangentAdd(Z, t, X, true) adds a tangent vector Z to a point X on the rank-r-manifold, scaled by t:</span>
0219     <span class="comment">%             res = X + t*Z</span>
0220     <span class="comment">%    and retracts the result back to the manifold:</span>
0221     <span class="comment">%            res = R_X( X + t*Z )</span>
0222     <span class="comment">%    where the result is stored as a TTeMPS tensor of rank r.</span>
0223     <span class="comment">%</span>
0224     
0225         <span class="keyword">if</span> ~exist( <span class="string">'retract'</span>, <span class="string">'var'</span> )
0226             retract = false;
0227         <span class="keyword">end</span>
0228 
0229         d = X.order;
0230         C = cell(1, d);
0231 
0232         C{1} = <a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS/cat.html" class="code" title="function z = cat( mu, x, y )">cat</a>( 3, t*Z.dU{1}, X.U{1} );
0233         <span class="keyword">for</span> i = 2:d-1
0234             zeroblock = zeros( size(X.U{i}) );
0235             tmp1 = <a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS/cat.html" class="code" title="function z = cat( mu, x, y )">cat</a>( 3, X.U{i}, zeroblock );
0236             tmp2 = <a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS/cat.html" class="code" title="function z = cat( mu, x, y )">cat</a>( 3, t*Z.dU{i}, X.U{i} );
0237             C{i} = <a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS/cat.html" class="code" title="function z = cat( mu, x, y )">cat</a>( 1, tmp1, tmp2 );
0238         <span class="keyword">end</span>
0239         C{d} = <a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS/cat.html" class="code" title="function z = cat( mu, x, y )">cat</a>( 1, X.U{d}, t*Z.dU{d} + X.U{d} );
0240         
0241         Xnew = <a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS/TTeMPS.html" class="code" title="">TTeMPS</a>( C );
0242     
0243         <span class="keyword">if</span> retract
0244             Xnew = <a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS/truncate.html" class="code" title="function x = truncate( x, r )">truncate</a>( Xnew, X.rank );
0245         <span class="keyword">end</span>
0246         
0247     <span class="keyword">end</span>
0248     
0249     <a name="_sub7" href="#_subfunctions" class="code">function res = innerprod( Z1, Z2, X )</a>
0250         
0251         X1 = <a href="#_sub10" class="code" title="subfunction res = tangent_to_TTeMPS( Z, X)">tangent_to_TTeMPS</a>( Z1, X );
0252         X2 = <a href="#_sub10" class="code" title="subfunction res = tangent_to_TTeMPS( Z, X)">tangent_to_TTeMPS</a>( Z2, X );
0253         
0254         res = <a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS/innerprod.html" class="code" title="function res = innerprod( x, y, dir, upto, storeParts )">innerprod</a>( X1, X2 );
0255     <span class="keyword">end</span>
0256     
0257     <a name="_sub8" href="#_subfunctions" class="code">function res = at_Omega( Z, ind, X)</a>
0258         
0259         Xnew = <a href="#_sub10" class="code" title="subfunction res = tangent_to_TTeMPS( Z, X)">tangent_to_TTeMPS</a>( Z, X );
0260         res = Xnew(ind);
0261     <span class="keyword">end</span>
0262     
0263     <a name="_sub9" href="#_subfunctions" class="code">function res = tangent_to_TTeMPS( Z, X)</a>
0264         d = X.order;
0265         C = cell(1, d);
0266 
0267         C{1} = <a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS/cat.html" class="code" title="function z = cat( mu, x, y )">cat</a>( 3, Z.dU{1}, X.U{1} );
0268         <span class="keyword">for</span> i = 2:d-1
0269             zeroblock = zeros( size(X.U{i}) );
0270             tmp1 = <a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS/cat.html" class="code" title="function z = cat( mu, x, y )">cat</a>( 3, X.U{i}, zeroblock );
0271             tmp2 = <a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS/cat.html" class="code" title="function z = cat( mu, x, y )">cat</a>( 3, Z.dU{i}, X.U{i} );
0272             C{i} = <a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS/cat.html" class="code" title="function z = cat( mu, x, y )">cat</a>( 1, tmp1, tmp2 );
0273         <span class="keyword">end</span>
0274         C{d} = <a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS/cat.html" class="code" title="function z = cat( mu, x, y )">cat</a>( 1, X.U{d}, Z.dU{d});
0275         
0276         res = <a href="../../../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS/TTeMPS.html" class="code" title="">TTeMPS</a>( C );
0277     <span class="keyword">end</span>
0278 <span class="keyword">end</span>
0279     
0280     
0281     
0282     
0283 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Sun 05-Sep-2021 17:57:00 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>