<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of essentialfactory</title>
  <meta name="keywords" content="essentialfactory">
  <meta name="description" content="Manifold structure to optimize over the space of essential matrices.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="#">manopt</a> &gt; <a href="#">manifolds</a> &gt; <a href="index.html">essential</a> &gt; essentialfactory.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for manopt\manifolds\essential&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>essentialfactory
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>Manifold structure to optimize over the space of essential matrices.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function M = essentialfactory(k, strSigned) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> Manifold structure to optimize over the space of essential matrices.

 function M = essentialfactory(k)
 function M = essentialfactory(k, 'signed')
 function M = essentialfactory(k, 'unsigned')


 Quotient representation of the essential manifold: deals with the
 representation of the space of essential matrices M_rE. These are used in
 computer vision to represent the epipolar constraint between projected
 points in two perspective views.

 The space is represented as the quotient (SO(3)^2/SO(2)).
 See the following references for details:

   R. Tron, K. Daniilidis,
   &quot;On the quotient representation of the essential manifold&quot;
   IEEE Conference on Computer Vision and Pattern Recognition, 2014

 For computational purposes, each essential matrix is represented as a
 [3x6] matrix where each [3x3] block is a rotation.

 The metric used is the one induced by the submersion of M_rE in SO(3)^2.

 Tangent vectors are represented in the Lie algebra of SO(3)^2, i.e., as
 [3x6] matrices where each [3x3] block is a skew-symmetric matrix.
 Use the function tangent2ambient(X, H) to switch from the Lie algebra
 representation to the embedding space representation in R^(3x6).

 By default, k = 1, and the geometry is 'signed'.

 Optional arguments:
   &quot;signed&quot;    selects the signed version of the manifold
   &quot;unsigned&quot;  selects the unsigned version of the manifold

 See also rotationsfactory</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="essential_flat.html" class="code" title="function Hp = essential_flat(H)">essential_flat</a>	Reshape a [3x6xk] matrix to a [3x3x2k] matrix</li><li><a href="essential_hat3.html" class="code" title="function [V, vShift] = essential_hat3(v)">essential_hat3</a>	Compute the matrix representation of the cross product</li><li><a href="essential_sharp.html" class="code" title="function H = essential_sharp(Hp)">essential_sharp</a>	Reshape a [3x3x2k] matrix to a [3x6xk] matrix</li><li><a href="../../../manopt/manifolds/essential/privateessential/essential_closestRepresentative.html" class="code" title="function Q2r=essential_closestRepresentative(Q1,Q2,varargin)">essential_closestRepresentative</a>	</li><li><a href="../../../manopt/manifolds/rotations/randrot.html" class="code" title="function Q = randrot(n, N)">randrot</a>	Generates uniformly random rotation matrices.</li><li><a href="../../../manopt/manifolds/rotations/randskew.html" class="code" title="function S = randskew(n, N)">randskew</a>	Generates random skew symmetric matrices with normal entries.</li><li><a href="../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS/cat.html" class="code" title="function z = cat( mu, x, y )">cat</a>	CAT concatenation of two TT/MPS tensors.</li><li><a href="../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS/norm.html" class="code" title="function res = norm( x, safe )">norm</a>	NORM Norm of a TT/MPS tensor.</li><li><a href="../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS/round.html" class="code" title="function x = round( x, tol )">round</a>	ROUND Approximate TTeMPS tensor within a prescribed tolerance.</li><li><a href="../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS_block/norm.html" class="code" title="function res = norm( x )">norm</a>	NORM Norm of a TT/MPS block-mu tensor.</li><li><a href="../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS_block/round.html" class="code" title="function x = round( x, tol )">round</a>	ROUND Approximate TTeMPS tensor within a prescribed tolerance.</li><li><a href="../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS_op/round.html" class="code" title="function A = round(A, tol )">round</a>	ROUND Approximate TTeMPS operator within a prescribed tolerance.</li><li><a href="../../../manopt/tools/hashmd5.html" class="code" title="function h = hashmd5(inp)">hashmd5</a>	Computes the MD5 hash of input data.</li><li><a href="../../../manopt/tools/matrixlincomb.html" class="code" title="function v = matrixlincomb(x, a1, d1, a2, d2) %#ok<INUSL>">matrixlincomb</a>	Linear combination function for tangent vectors represented as matrices.</li><li><a href="../../../manopt/tools/multiprod.html" class="code" title="function C = multiprod(A, B, unused1, unused2) %#ok<INUSD>">multiprod</a>	Matrix multiply 2-D slices of N-D arrays</li><li><a href="../../../manopt/tools/multiskew.html" class="code" title="function Y = multiskew(X)">multiskew</a>	Returns the skew-symmetric parts of the matrices in the 3D matrix X.</li><li><a href="../../../manopt/tools/multisym.html" class="code" title="function Y = multisym(X)">multisym</a>	Returns the symmetric parts of the matrices in a 3D array</li><li><a href="../../../manopt/tools/multitrace.html" class="code" title="function tr = multitrace(A)">multitrace</a>	Computes the traces of the 2D slices in a 3D matrix.</li><li><a href="../../../manopt/tools/multitransp.html" class="code" title="function B = multitransp(A, unused) %#ok<INUSD>">multitransp</a>	Transpose the matrix slices of an N-D array (no complex conjugate)</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../examples/essential_svd.html" class="code" title="function essential_svd">essential_svd</a>	Sample solution of an optimization problem on the essential manifold.</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function HProjHoriz=tangentProjection(X,H)</a></li><li><a href="#_sub2" class="code">function rgrad = egrad2rgrad(X, egrad)</a></li><li><a href="#_sub3" class="code">function rhess = ehess2rhess(X, egrad, ehess, S)</a></li><li><a href="#_sub4" class="code">function Y = exponential(X, U, t)</a></li><li><a href="#_sub5" class="code">function U = logarithm(X, Y)</a></li><li><a href="#_sub6" class="code">function Q = randessential(N)</a></li><li><a href="#_sub7" class="code">function U = randomvec(X)</a></li><li><a href="#_sub8" class="code">function S2 = transport(X1, X2, S1)</a></li><li><a href="#_sub9" class="code">function Y = pairmean(X1, X2)</a></li><li><a href="#_sub10" class="code">function v = vee3(V)</a></li><li><a href="#_sub11" class="code">function R = rot3_exp(V)</a></li><li><a href="#_sub12" class="code">function V = rot3_log(R)</a></li><li><a href="#_sub13" class="code">function sx = sincN(x)</a></li><li><a href="#_sub14" class="code">function nv = cnorm(v)</a></li><li><a href="#_sub15" class="code">function M = vertproj(X, H)</a></li><li><a href="#_sub16" class="code">function M = p1(X)</a></li><li><a href="#_sub17" class="code">function M = p2(X)</a></li><li><a href="#_sub18" class="code">function U = tangent2ambient(X, H)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function M = essentialfactory(k, strSigned)</a>
0002 <span class="comment">% Manifold structure to optimize over the space of essential matrices.</span>
0003 <span class="comment">%</span>
0004 <span class="comment">% function M = essentialfactory(k)</span>
0005 <span class="comment">% function M = essentialfactory(k, 'signed')</span>
0006 <span class="comment">% function M = essentialfactory(k, 'unsigned')</span>
0007 <span class="comment">%</span>
0008 <span class="comment">%</span>
0009 <span class="comment">% Quotient representation of the essential manifold: deals with the</span>
0010 <span class="comment">% representation of the space of essential matrices M_rE. These are used in</span>
0011 <span class="comment">% computer vision to represent the epipolar constraint between projected</span>
0012 <span class="comment">% points in two perspective views.</span>
0013 <span class="comment">%</span>
0014 <span class="comment">% The space is represented as the quotient (SO(3)^2/SO(2)).</span>
0015 <span class="comment">% See the following references for details:</span>
0016 <span class="comment">%</span>
0017 <span class="comment">%   R. Tron, K. Daniilidis,</span>
0018 <span class="comment">%   &quot;On the quotient representation of the essential manifold&quot;</span>
0019 <span class="comment">%   IEEE Conference on Computer Vision and Pattern Recognition, 2014</span>
0020 <span class="comment">%</span>
0021 <span class="comment">% For computational purposes, each essential matrix is represented as a</span>
0022 <span class="comment">% [3x6] matrix where each [3x3] block is a rotation.</span>
0023 <span class="comment">%</span>
0024 <span class="comment">% The metric used is the one induced by the submersion of M_rE in SO(3)^2.</span>
0025 <span class="comment">%</span>
0026 <span class="comment">% Tangent vectors are represented in the Lie algebra of SO(3)^2, i.e., as</span>
0027 <span class="comment">% [3x6] matrices where each [3x3] block is a skew-symmetric matrix.</span>
0028 <span class="comment">% Use the function tangent2ambient(X, H) to switch from the Lie algebra</span>
0029 <span class="comment">% representation to the embedding space representation in R^(3x6).</span>
0030 <span class="comment">%</span>
0031 <span class="comment">% By default, k = 1, and the geometry is 'signed'.</span>
0032 <span class="comment">%</span>
0033 <span class="comment">% Optional arguments:</span>
0034 <span class="comment">%   &quot;signed&quot;    selects the signed version of the manifold</span>
0035 <span class="comment">%   &quot;unsigned&quot;  selects the unsigned version of the manifold</span>
0036 <span class="comment">%</span>
0037 <span class="comment">% See also rotationsfactory</span>
0038 
0039 <span class="comment">% Please cite the Manopt paper as well as the research paper:</span>
0040 <span class="comment">%     @InProceedings{tron2014essential,</span>
0041 <span class="comment">%       Title        = {On the quotient representation of the essential manifold},</span>
0042 <span class="comment">%       Author       = {Tron, R. and Daniilidis, K.},</span>
0043 <span class="comment">%       Booktitle    = {IEEE Conference on Computer Vision and Pattern Recognition},</span>
0044 <span class="comment">%       Year         = {2014},</span>
0045 <span class="comment">%       Organization = {{IEEE CVPR}}</span>
0046 <span class="comment">%     }</span>
0047 
0048 
0049 <span class="comment">% This file is part of Manopt: www.manopt.org.</span>
0050 <span class="comment">% Original author: Roberto Tron, Aug. 8, 2014</span>
0051 <span class="comment">% Contributors: Bamdev Mishra, May 15, 2015.</span>
0052 <span class="comment">% Change log:</span>
0053 <span class="comment">%   Jan. 4, 2021 (NB):</span>
0054 <span class="comment">%       Compatibility with Octave 6.1.0: moved quite a few nested functions</span>
0055 <span class="comment">%       to end-of-file functions, and made tangent2ambient accessible as</span>
0056 <span class="comment">%       M.tangent2ambient (which should have been the case already).</span>
0057 
0058 <span class="comment">% RT: General implementation note: to streamline component-wise</span>
0059 <span class="comment">% computations, in tangentProjection and exponential,</span>
0060 <span class="comment">% we flatten out the arguments into [3 x 3 x 2K] arrays, compute the</span>
0061 <span class="comment">% components all together, and then sharp the result again into [3 x 6 x K]</span>
0062 <span class="comment">% arrays.</span>
0063 
0064 
0065     <span class="comment">% Optional parameters to switch between the signed and unsigned</span>
0066     <span class="comment">% versions of the manifold.</span>
0067     <span class="keyword">if</span> ~exist(<span class="string">'strSigned'</span>, <span class="string">'var'</span>) || isempty(strSigned)
0068         strSigned = <span class="string">'signed'</span>;
0069     <span class="keyword">end</span>
0070     <span class="keyword">switch</span>(strSigned)
0071         <span class="keyword">case</span> <span class="string">'signed'</span>
0072             flagSigned = true;
0073         <span class="keyword">case</span> <span class="string">'unsigned'</span>
0074             flagSigned = false;
0075         <span class="keyword">otherwise</span>
0076             error(<span class="string">'Second argument can be either empty, ''signed'', or ''unsigned''.'</span>);
0077     <span class="keyword">end</span>
0078 
0079     
0080     <span class="keyword">if</span> ~exist(<span class="string">'k'</span>, <span class="string">'var'</span>) || isempty(k)
0081         k = 1;
0082     <span class="keyword">end</span>
0083     
0084     <span class="keyword">if</span> k == 1
0085         M.name = @() sprintf(<span class="string">'Quotient representation of the essential manifold, %s'</span>, strSigned);
0086     <span class="keyword">elseif</span> k &gt; 1 &amp;&amp; k == <a href="../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS/round.html" class="code" title="function x = round( x, tol )">round</a>(k)
0087         M.name = @() sprintf(<span class="string">'Product of %d quotient representations of the essential manifold, %s'</span>, k, strSigned);
0088     <span class="keyword">else</span>
0089         error(<span class="string">'k must be an integer no less than 1.'</span>);
0090     <span class="keyword">end</span>
0091     
0092     M.dim = @() k*5;
0093     
0094     M.inner = @(x, d1, d2) d1(:).'*d2(:);
0095     
0096     M.norm = @(x, d) <a href="../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS/norm.html" class="code" title="function res = norm( x, safe )">norm</a>(d(:));
0097     
0098     M.typicaldist = @() pi*sqrt(2*k);
0099     
0100     M.proj = @<a href="#_sub1" class="code" title="subfunction HProjHoriz=tangentProjection(X,H)">tangentProjection</a>;
0101     <a name="_sub1" href="#_subfunctions" class="code">function HProjHoriz=tangentProjection(X,H)</a>
0102         <span class="comment">% Project H on the tangent space of SO(3)^2</span>
0103         HProj = <a href="essential_sharp.html" class="code" title="function H = essential_sharp(Hp)">essential_sharp</a>(<a href="../../../manopt/tools/multiskew.html" class="code" title="function Y = multiskew(X)">multiskew</a>(<a href="../../../manopt/tools/multiprod.html" class="code" title="function C = multiprod(A, B, unused1, unused2) %#ok<INUSD>">multiprod</a>(<a href="../../../manopt/tools/multitransp.html" class="code" title="function B = multitransp(A, unused) %#ok<INUSD>">multitransp</a>(<a href="essential_flat.html" class="code" title="function Hp = essential_flat(H)">essential_flat</a>(X)), <a href="essential_flat.html" class="code" title="function Hp = essential_flat(H)">essential_flat</a>(H))));
0104         
0105         <span class="comment">% Compute projection on vertical component</span>
0106         p = <a href="#_sub15" class="code" title="subfunction M = vertproj(X, H)">vertproj</a>(X, HProj);
0107         
0108         HProjHoriz = HProj - <a href="../../../manopt/tools/multiprod.html" class="code" title="function C = multiprod(A, B, unused1, unused2) %#ok<INUSD>">multiprod</a>(p/2,[<a href="essential_hat3.html" class="code" title="function [V, vShift] = essential_hat3(v)">essential_hat3</a>(permute(X(3,1:3,:),[2 3 1])) <a href="essential_hat3.html" class="code" title="function [V, vShift] = essential_hat3(v)">essential_hat3</a>(permute(X(3,4:6,:),[2 3 1]))]);<span class="comment">% BM: okay</span>
0109     <span class="keyword">end</span>
0110     
0111     
0112     M.tangent = @(X, H) <a href="essential_sharp.html" class="code" title="function H = essential_sharp(Hp)">essential_sharp</a>(<a href="../../../manopt/tools/multiskew.html" class="code" title="function Y = multiskew(X)">multiskew</a>(<a href="essential_flat.html" class="code" title="function Hp = essential_flat(H)">essential_flat</a>(H)));
0113     
0114     M.egrad2rgrad=@<a href="#_sub2" class="code" title="subfunction rgrad = egrad2rgrad(X, egrad)">egrad2rgrad</a>;
0115     <a name="_sub2" href="#_subfunctions" class="code">function rgrad = egrad2rgrad(X, egrad)</a>
0116         rgrad = M.proj(X, egrad);
0117     <span class="keyword">end</span>
0118     
0119     M.ehess2rhess = @<a href="#_sub3" class="code" title="subfunction rhess = ehess2rhess(X, egrad, ehess, S)">ehess2rhess</a>;
0120     <a name="_sub3" href="#_subfunctions" class="code">function rhess = ehess2rhess(X, egrad, ehess, S)</a>
0121         <span class="comment">% Reminder: S contains skew-symmetric matrices. The actual</span>
0122         <span class="comment">% direction that the point X is moved along is X*S.</span>
0123         RA = <a href="#_sub16" class="code" title="subfunction M = p1(X)">p1</a>(X);
0124         RB = <a href="#_sub17" class="code" title="subfunction M = p2(X)">p2</a>(X);
0125         SA = <a href="#_sub16" class="code" title="subfunction M = p1(X)">p1</a>(S);
0126         SB = <a href="#_sub17" class="code" title="subfunction M = p2(X)">p2</a>(S);
0127         
0128         G = egrad; 
0129         GA = <a href="#_sub16" class="code" title="subfunction M = p1(X)">p1</a>(G);
0130         GB = <a href="#_sub17" class="code" title="subfunction M = p2(X)">p2</a>(G);
0131         
0132         H = ehess; 
0133         
0134         <span class="comment">% RT: We now compute the connection, i.e. the part of the derivative</span>
0135         <span class="comment">% given by the curvature of the space (as opposed to a simple</span>
0136         <span class="comment">% Euclidean derivative).</span>
0137         
0138         <span class="comment">% The following is the vectorized version of connection=-[multisym(GA'*RA)*SA multisym(GB'*RB)*SB];</span>
0139         connection = <a href="#_sub18" class="code" title="subfunction U = tangent2ambient(X, H)">tangent2ambient</a>(X,-<a href="../../../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS/cat.html" class="code" title="function z = cat( mu, x, y )">cat</a>(2,<span class="keyword">...</span>
0140             <a href="../../../manopt/tools/multiprod.html" class="code" title="function C = multiprod(A, B, unused1, unused2) %#ok<INUSD>">multiprod</a>(<a href="../../../manopt/tools/multisym.html" class="code" title="function Y = multisym(X)">multisym</a>(<a href="../../../manopt/tools/multiprod.html" class="code" title="function C = multiprod(A, B, unused1, unused2) %#ok<INUSD>">multiprod</a>(<a href="../../../manopt/tools/multitransp.html" class="code" title="function B = multitransp(A, unused) %#ok<INUSD>">multitransp</a>(GA), RA)), SA),<span class="keyword">...</span>
0141             <a href="../../../manopt/tools/multiprod.html" class="code" title="function C = multiprod(A, B, unused1, unused2) %#ok<INUSD>">multiprod</a>(<a href="../../../manopt/tools/multisym.html" class="code" title="function Y = multisym(X)">multisym</a>(<a href="../../../manopt/tools/multiprod.html" class="code" title="function C = multiprod(A, B, unused1, unused2) %#ok<INUSD>">multiprod</a>(<a href="../../../manopt/tools/multitransp.html" class="code" title="function B = multitransp(A, unused) %#ok<INUSD>">multitransp</a>(GB), RB)), SB)));
0142         rhess = M.proj(X,H + connection);
0143     <span class="keyword">end</span>
0144     
0145     
0146     
0147     M.exp = @<a href="#_sub4" class="code" title="subfunction Y = exponential(X, U, t)">exponential</a>;
0148     <a name="_sub4" href="#_subfunctions" class="code">function Y = exponential(X, U, t)</a>
0149         <span class="keyword">if</span> nargin == 3
0150             U = t*U;
0151         <span class="keyword">end</span>
0152         
0153         UFlat = <a href="essential_flat.html" class="code" title="function Hp = essential_flat(H)">essential_flat</a>(U);
0154         exptUFlat = <a href="#_sub11" class="code" title="subfunction R = rot3_exp(V)">rot3_exp</a>(UFlat);
0155         Y = <a href="essential_sharp.html" class="code" title="function H = essential_sharp(Hp)">essential_sharp</a>(<a href="../../../manopt/tools/multiprod.html" class="code" title="function C = multiprod(A, B, unused1, unused2) %#ok<INUSD>">multiprod</a>(<a href="essential_flat.html" class="code" title="function Hp = essential_flat(H)">essential_flat</a>(X), exptUFlat));
0156     <span class="keyword">end</span>
0157     
0158     M.retr = @<a href="#_sub4" class="code" title="subfunction Y = exponential(X, U, t)">exponential</a>;
0159     
0160     M.log = @<a href="#_sub5" class="code" title="subfunction U = logarithm(X, Y)">logarithm</a>; 
0161     <a name="_sub5" href="#_subfunctions" class="code">function U = logarithm(X, Y)</a>
0162         
0163         QX = [X(:,1:3,:);X(:,4:6,:)];
0164         QY = [Y(:,1:3,:);Y(:,4:6,:)];
0165         QYr = <a href="../../../manopt/manifolds/essential/privateessential/essential_closestRepresentative.html" class="code" title="function Q2r=essential_closestRepresentative(Q1,Q2,varargin)">essential_closestRepresentative</a>(QX,QY,<span class="string">'flagSigned'</span>,flagSigned);
0166         Yr = [QYr(1:3,:,:) QYr(4:6,:,:)];
0167         U = zeros(size(X));
0168         U(:,1:3,:) = <a href="#_sub12" class="code" title="subfunction V = rot3_log(R)">rot3_log</a>(<a href="../../../manopt/tools/multiprod.html" class="code" title="function C = multiprod(A, B, unused1, unused2) %#ok<INUSD>">multiprod</a>(<a href="../../../manopt/tools/multitransp.html" class="code" title="function B = multitransp(A, unused) %#ok<INUSD>">multitransp</a>(X(:,1:3,:)),Yr(:,1:3,:)));
0169         U(:,4:6,:) = <a href="#_sub12" class="code" title="subfunction V = rot3_log(R)">rot3_log</a>(<a href="../../../manopt/tools/multiprod.html" class="code" title="function C = multiprod(A, B, unused1, unused2) %#ok<INUSD>">multiprod</a>(<a href="../../../manopt/tools/multitransp.html" class="code" title="function B = multitransp(A, unused) %#ok<INUSD>">multitransp</a>(X(:,4:6,:)),Yr(:,4:6,:)));
0170     <span class="keyword">end</span>
0171     
0172     M.hash = @(X) [<span class="string">'z'</span> <a href="../../../manopt/tools/hashmd5.html" class="code" title="function h = hashmd5(inp)">hashmd5</a>(X(:))];
0173     
0174     M.rand = @() <a href="#_sub6" class="code" title="subfunction Q = randessential(N)">randessential</a>(k);
0175     <a name="_sub6" href="#_subfunctions" class="code">function Q = randessential(N)</a>
0176         <span class="comment">% Generates random essential matrices.</span>
0177         <span class="comment">%</span>
0178         <span class="comment">% function Q = randessential(N)</span>
0179         <span class="comment">%</span>
0180         <span class="comment">% Q is a [3x6] matrix where each [3x3] block is a uniformly distributed</span>
0181         <span class="comment">% matrix.</span>
0182         
0183         <span class="keyword">if</span> nargin &lt; 1
0184             N = 1;
0185         <span class="keyword">end</span>
0186         
0187         Q = [<a href="../../../manopt/manifolds/rotations/randrot.html" class="code" title="function Q = randrot(n, N)">randrot</a>(3,N) <a href="../../../manopt/manifolds/rotations/randrot.html" class="code" title="function Q = randrot(n, N)">randrot</a>(3,N)];
0188     <span class="keyword">end</span>
0189     
0190     M.randvec = @<a href="#_sub7" class="code" title="subfunction U = randomvec(X)">randomvec</a>;
0191     <a name="_sub7" href="#_subfunctions" class="code">function U = randomvec(X)</a>
0192         U = <a href="#_sub1" class="code" title="subfunction HProjHoriz=tangentProjection(X,H)">tangentProjection</a>(X, <a href="essential_sharp.html" class="code" title="function H = essential_sharp(Hp)">essential_sharp</a>(<a href="../../../manopt/manifolds/rotations/randskew.html" class="code" title="function S = randskew(n, N)">randskew</a>(3, 2*k)));
0193         U = U / sqrt(M.inner([],U,U));
0194     <span class="keyword">end</span>
0195     
0196     M.lincomb = @<a href="../../../manopt/tools/matrixlincomb.html" class="code" title="function v = matrixlincomb(x, a1, d1, a2, d2) %#ok<INUSL>">matrixlincomb</a>;
0197     
0198     M.zerovec = @(x) zeros(3, 6, k);
0199     
0200     M.transp = @<a href="#_sub8" class="code" title="subfunction S2 = transport(X1, X2, S1)">transport</a>;
0201     <a name="_sub8" href="#_subfunctions" class="code">function S2 = transport(X1, X2, S1)</a>
0202         <span class="comment">% Transport a vector from the tangent space at X1 to the tangent</span>
0203         <span class="comment">% space at X2. This transport uses the left translation of the</span>
0204         <span class="comment">% ambient group and preserves the norm of S1. The left translation</span>
0205         <span class="comment">% aligns the vertical spaces at the two elements.</span>
0206         
0207         <span class="comment">% Group operation in the ambient group, X12=X2'*X1</span>
0208         X12 = <a href="essential_sharp.html" class="code" title="function H = essential_sharp(Hp)">essential_sharp</a>(<a href="../../../manopt/tools/multiprod.html" class="code" title="function C = multiprod(A, B, unused1, unused2) %#ok<INUSD>">multiprod</a>(<a href="../../../manopt/tools/multitransp.html" class="code" title="function B = multitransp(A, unused) %#ok<INUSD>">multitransp</a>(<a href="essential_flat.html" class="code" title="function Hp = essential_flat(H)">essential_flat</a>(X2)),<a href="essential_flat.html" class="code" title="function Hp = essential_flat(H)">essential_flat</a>(X1)));
0209         X12Flat = <a href="essential_flat.html" class="code" title="function Hp = essential_flat(H)">essential_flat</a>(X12);
0210         
0211         <span class="comment">% Left translation, S2=X12*S*X12'</span>
0212         S2 = <a href="essential_sharp.html" class="code" title="function H = essential_sharp(Hp)">essential_sharp</a>(<a href="../../../manopt/tools/multiprod.html" class="code" title="function C = multiprod(A, B, unused1, unused2) %#ok<INUSD>">multiprod</a>(X12Flat,<a href="../../../manopt/tools/multiprod.html" class="code" title="function C = multiprod(A, B, unused1, unused2) %#ok<INUSD>">multiprod</a>(<a href="essential_flat.html" class="code" title="function Hp = essential_flat(H)">essential_flat</a>(S1),<a href="../../../manopt/tools/multitransp.html" class="code" title="function B = multitransp(A, unused) %#ok<INUSD>">multitransp</a>(X12Flat))));
0213     <span class="keyword">end</span>
0214     
0215     M.pairmean = @<a href="#_sub9" class="code" title="subfunction Y = pairmean(X1, X2)">pairmean</a>;
0216     <a name="_sub9" href="#_subfunctions" class="code">function Y = pairmean(X1, X2)</a>
0217         V = M.log(X1, X2);
0218         Y = M.exp(X1, .5*V);
0219     <span class="keyword">end</span>
0220     
0221     M.dist = @(x, y) M.norm(x, M.log(x, y)); 
0222     
0223     M.vec = @(x, u_mat) u_mat(:);
0224     M.mat = @(x, u_vec) reshape(u_vec, [3, 6, k]);
0225     M.vecmatareisometries = @() true;
0226     
0227     M.tangent2ambient = @<a href="#_sub18" class="code" title="subfunction U = tangent2ambient(X, H)">tangent2ambient</a>;
0228     
0229 <span class="keyword">end</span>
0230 
0231 
0232 <span class="comment">%% Some functions used by the essential factory</span>
0233 
0234 <a name="_sub10" href="#_subfunctions" class="code">function v = vee3(V)</a>
0235     v = squeeze([V(3,2,:)-V(2,3,:); V(1,3,:)-V(3,1,:); V(2,1,:)-V(1,2,:)])/2;
0236 <span class="keyword">end</span>
0237 
0238 
0239 <span class="comment">% Compute the exponential map in SO(3) using Rodrigues' formula</span>
0240 <span class="comment">%  function R = rot3_exp(V)</span>
0241 <span class="comment">% V must be a [3x3xN] array of [3x3] skew-symmetric matrices.</span>
0242 <a name="_sub11" href="#_subfunctions" class="code">function R = rot3_exp(V)</a>
0243     v = <a href="#_sub10" class="code" title="subfunction v = vee3(V)">vee3</a>(V);
0244     nv = <a href="#_sub14" class="code" title="subfunction nv = cnorm(v)">cnorm</a>(v);
0245     idxZero = nv &lt; 1e-15;
0246     nvMod = nv;
0247     nvMod(idxZero) = 1;
0248     
0249     vNorm = v./([1;1;1]*nvMod);
0250     
0251     <span class="comment">% Matrix exponential using Rodrigues' formula</span>
0252     nv = shiftdim(nv,-1);
0253     c = cos(nv);
0254     s = sin(nv);
0255     [VNorm,vNormShift] = <a href="essential_hat3.html" class="code" title="function [V, vShift] = essential_hat3(v)">essential_hat3</a>(vNorm);
0256     vNormvNormT = <a href="../../../manopt/tools/multiprod.html" class="code" title="function C = multiprod(A, B, unused1, unused2) %#ok<INUSD>">multiprod</a>(vNormShift,<a href="../../../manopt/tools/multitransp.html" class="code" title="function B = multitransp(A, unused) %#ok<INUSD>">multitransp</a>(vNormShift));
0257     R=<a href="../../../manopt/tools/multiprod.html" class="code" title="function C = multiprod(A, B, unused1, unused2) %#ok<INUSD>">multiprod</a>(eye(3),c)+<a href="../../../manopt/tools/multiprod.html" class="code" title="function C = multiprod(A, B, unused1, unused2) %#ok<INUSD>">multiprod</a>(VNorm,s)+<a href="../../../manopt/tools/multiprod.html" class="code" title="function C = multiprod(A, B, unused1, unused2) %#ok<INUSD>">multiprod</a>(vNormvNormT,1-c);
0258 <span class="keyword">end</span>
0259 
0260 
0261 
0262 <span class="comment">% Compute the logarithm map in SO(3)</span>
0263 <span class="comment">%  function V = rot3_log(R)</span>
0264 <span class="comment">% V is a [3x3xN] array of [3x3] skew-symmetric matrices</span>
0265 <a name="_sub12" href="#_subfunctions" class="code">function V = rot3_log(R)</a>
0266     skewR = <a href="../../../manopt/tools/multiskew.html" class="code" title="function Y = multiskew(X)">multiskew</a>(R);
0267     ctheta = (<a href="../../../manopt/tools/multitrace.html" class="code" title="function tr = multitrace(A)">multitrace</a>(R)'-1)/2;
0268     stheta = <a href="#_sub14" class="code" title="subfunction nv = cnorm(v)">cnorm</a>(<a href="#_sub10" class="code" title="subfunction v = vee3(V)">vee3</a>(skewR));
0269     theta = atan2(stheta,ctheta);
0270     
0271     V=skewR;
0272     <span class="keyword">for</span> ik=1:size(R,3)
0273         V(:,:,ik)=V(:,:,ik)/<a href="#_sub13" class="code" title="subfunction sx = sincN(x)">sincN</a>(theta(ik));
0274     <span class="keyword">end</span>
0275 <span class="keyword">end</span>
0276 
0277 
0278 <a name="_sub13" href="#_subfunctions" class="code">function sx = sincN(x)</a>
0279     sx = sin(x)./x;
0280     sx(x==0) = 1;
0281 <span class="keyword">end</span>
0282 
0283 <a name="_sub14" href="#_subfunctions" class="code">function nv = cnorm(v)</a>
0284     nv = sqrt(sum(v.^2));
0285 <span class="keyword">end</span>
0286 
0287 <a name="_sub15" href="#_subfunctions" class="code">function M = vertproj(X, H)</a>
0288     M = <a href="../../../manopt/tools/multiprod.html" class="code" title="function C = multiprod(A, B, unused1, unused2) %#ok<INUSD>">multiprod</a>(X(3, 1:3, :), permute(<a href="#_sub10" class="code" title="subfunction v = vee3(V)">vee3</a>(H(:, 1:3, :)), [1 3 2])) + <span class="keyword">...</span>
0289         <a href="../../../manopt/tools/multiprod.html" class="code" title="function C = multiprod(A, B, unused1, unused2) %#ok<INUSD>">multiprod</a>(X(3, 4:6, :), permute(<a href="#_sub10" class="code" title="subfunction v = vee3(V)">vee3</a>(H(:, 4:6, :)), [1 3 2]));
0290 <span class="keyword">end</span>
0291 
0292 <a name="_sub16" href="#_subfunctions" class="code">function M = p1(X)</a>
0293     M = X(:, 1:3, :);
0294 <span class="keyword">end</span>
0295 
0296 <a name="_sub17" href="#_subfunctions" class="code">function M = p2(X)</a>
0297     M = X(:, 4:6, :);
0298 <span class="keyword">end</span>
0299 
0300 <a name="_sub18" href="#_subfunctions" class="code">function U = tangent2ambient(X, H)</a>
0301     U = <a href="essential_sharp.html" class="code" title="function H = essential_sharp(Hp)">essential_sharp</a>(<a href="../../../manopt/tools/multiprod.html" class="code" title="function C = multiprod(A, B, unused1, unused2) %#ok<INUSD>">multiprod</a>(<a href="essential_flat.html" class="code" title="function Hp = essential_flat(H)">essential_flat</a>(X), <a href="essential_flat.html" class="code" title="function Hp = essential_flat(H)">essential_flat</a>(H)));
0302 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Sun 05-Sep-2021 17:57:00 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>