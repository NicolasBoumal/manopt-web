<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of essentialfactory</title>
  <meta name="keywords" content="essentialfactory">
  <meta name="description" content="Manifold structure to optimize over the space of essential matrices.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="#">manopt</a> &gt; <a href="#">manifolds</a> &gt; <a href="index.html">essential</a> &gt; essentialfactory.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for manopt\manifolds\essential&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>essentialfactory
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>Manifold structure to optimize over the space of essential matrices.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function M = essentialfactory(k, strSigned) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> Manifold structure to optimize over the space of essential matrices.

 function M = essentialfactory(k)
 function M = essentialfactory(k, 'signed')
 function M = essentialfactory(k, 'unsigned')


 Quotient representation of the essential manifold: deals with the
 representation of the space of essential matrices M_rE. These are used in
 computer vision to represent the epipolar constraint between projected
 points in two perspective views.

 The space is represented as the quotient (SO(3)^2/SO(2)).
 See the following references for details:

   R. Tron, K. Daniilidis,
   &quot;On the quotient representation of the essential manifold&quot;
   IEEE Conference on Computer Vision and Pattern Recognition, 2014

 For computational purposes, each essential matrix is represented as a
 [3x6] matrix where each [3x3] block is a rotation.

 The metric used is the one induced by the submersion of M_rE in SO(3)^2.

 Tangent vectors are represented in the Lie algebra of SO(3)^2, i.e., as
 [3x6] matrices where each [3x3] block is a skew-symmetric matrix.
 Use the function tangent2ambient(X, H) to switch from the Lie algebra
 representation to the embedding space representation in R^(3x6).

 By default, k = 1, and the geometry is 'signed'.

 Optional arguments:
   &quot;signed&quot;    selects the signed version of the manifold
   &quot;unsigned&quot;  selects the unsigned version of the manifold

 See also rotationsfactory</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="essential_flat.html" class="code" title="function Hp = essential_flat(H)">essential_flat</a>	Reshape a [3x6xk] matrix to a [3x3x2k] matrix</li><li><a href="essential_hat3.html" class="code" title="function [V, vShift] = essential_hat3(v)">essential_hat3</a>	Compute the matrix representation of the cross product</li><li><a href="essential_sharp.html" class="code" title="function H = essential_sharp(Hp)">essential_sharp</a>	Reshape a [3x3x2k] matrix to a [3x6xk] matrix</li><li><a href="../../../manopt/manifolds/essential/privateessential/essential_closestRepresentative.html" class="code" title="function Q2r=essential_closestRepresentative(Q1,Q2,varargin)">essential_closestRepresentative</a>	</li><li><a href="../../../manopt/manifolds/rotations/randrot.html" class="code" title="function R = randrot(n, N)">randrot</a>	Generates uniformly random rotation matrices.</li><li><a href="../../../manopt/manifolds/rotations/randskew.html" class="code" title="function S = randskew(n, N)">randskew</a>	Generates random skew symmetric matrices with normal entries.</li><li><a href="../../../manopt/tools/hashmd5.html" class="code" title="function h = hashmd5(inp)">hashmd5</a>	Computes the MD5 hash of input data.</li><li><a href="../../../manopt/tools/matrixlincomb.html" class="code" title="function v = matrixlincomb(x, a1, d1, a2, d2) %#ok<INUSL>">matrixlincomb</a>	Linear combination function for tangent vectors represented as matrices.</li><li><a href="../../../manopt/tools/multiprod.html" class="code" title="function c = multiprod(a, b, idA, idB)">multiprod</a>	Multiplying 1-D or 2-D subarrays contained in two N-D arrays.</li><li><a href="../../../manopt/tools/multiskew.html" class="code" title="function Y = multiskew(X)">multiskew</a>	Returns the skew-symmetric parts of the matrices in the 3D matrix X.</li><li><a href="../../../manopt/tools/multisym.html" class="code" title="function Y = multisym(X)">multisym</a>	Returns the symmetric parts of the matrices in the 3D matrix X</li><li><a href="../../../manopt/tools/multitrace.html" class="code" title="function tr = multitrace(A)">multitrace</a>	Computes the traces of the 2D slices in a 3D matrix.</li><li><a href="../../../manopt/tools/multitransp.html" class="code" title="function b = multitransp(a, dim)">multitransp</a>	Transposing arrays of matrices.</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../examples/essential_svd.html" class="code" title="function essential_svd">essential_svd</a>	Sample solution of an optimization problem on the essential manifold.</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function HProjHoriz=tangentProjection(X,H)</a></li><li><a href="#_sub2" class="code">function rgrad = egrad2rgrad(X, egrad)</a></li><li><a href="#_sub3" class="code">function rhess = ehess2rhess(X, egrad, ehess, S)</a></li><li><a href="#_sub4" class="code">function Y = exponential(X, U, t)</a></li><li><a href="#_sub5" class="code">function U = logarithm(X, Y)</a></li><li><a href="#_sub6" class="code">function Q = randessential(N)</a></li><li><a href="#_sub7" class="code">function U = randomvec(X)</a></li><li><a href="#_sub8" class="code">function S2 = transport(X1, X2, S1)</a></li><li><a href="#_sub9" class="code">function Y = pairmean(X1, X2)</a></li><li><a href="#_sub10" class="code">function v = vee3(V)</a></li><li><a href="#_sub11" class="code">function R = rot3_exp(V)</a></li><li><a href="#_sub12" class="code">function V = rot3_log(R)</a></li><li><a href="#_sub13" class="code">function sx = sincN(x)</a></li><li><a href="#_sub14" class="code">function nv = cnorm(v)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function M = essentialfactory(k, strSigned)</a>
0002 <span class="comment">% Manifold structure to optimize over the space of essential matrices.</span>
0003 <span class="comment">%</span>
0004 <span class="comment">% function M = essentialfactory(k)</span>
0005 <span class="comment">% function M = essentialfactory(k, 'signed')</span>
0006 <span class="comment">% function M = essentialfactory(k, 'unsigned')</span>
0007 <span class="comment">%</span>
0008 <span class="comment">%</span>
0009 <span class="comment">% Quotient representation of the essential manifold: deals with the</span>
0010 <span class="comment">% representation of the space of essential matrices M_rE. These are used in</span>
0011 <span class="comment">% computer vision to represent the epipolar constraint between projected</span>
0012 <span class="comment">% points in two perspective views.</span>
0013 <span class="comment">%</span>
0014 <span class="comment">% The space is represented as the quotient (SO(3)^2/SO(2)).</span>
0015 <span class="comment">% See the following references for details:</span>
0016 <span class="comment">%</span>
0017 <span class="comment">%   R. Tron, K. Daniilidis,</span>
0018 <span class="comment">%   &quot;On the quotient representation of the essential manifold&quot;</span>
0019 <span class="comment">%   IEEE Conference on Computer Vision and Pattern Recognition, 2014</span>
0020 <span class="comment">%</span>
0021 <span class="comment">% For computational purposes, each essential matrix is represented as a</span>
0022 <span class="comment">% [3x6] matrix where each [3x3] block is a rotation.</span>
0023 <span class="comment">%</span>
0024 <span class="comment">% The metric used is the one induced by the submersion of M_rE in SO(3)^2.</span>
0025 <span class="comment">%</span>
0026 <span class="comment">% Tangent vectors are represented in the Lie algebra of SO(3)^2, i.e., as</span>
0027 <span class="comment">% [3x6] matrices where each [3x3] block is a skew-symmetric matrix.</span>
0028 <span class="comment">% Use the function tangent2ambient(X, H) to switch from the Lie algebra</span>
0029 <span class="comment">% representation to the embedding space representation in R^(3x6).</span>
0030 <span class="comment">%</span>
0031 <span class="comment">% By default, k = 1, and the geometry is 'signed'.</span>
0032 <span class="comment">%</span>
0033 <span class="comment">% Optional arguments:</span>
0034 <span class="comment">%   &quot;signed&quot;    selects the signed version of the manifold</span>
0035 <span class="comment">%   &quot;unsigned&quot;  selects the unsigned version of the manifold</span>
0036 <span class="comment">%</span>
0037 <span class="comment">% See also rotationsfactory</span>
0038 
0039 <span class="comment">% Please cite the Manopt paper as well as the research paper:</span>
0040 <span class="comment">%     @InProceedings{tron2014essential,</span>
0041 <span class="comment">%       Title        = {On the quotient representation of the essential manifold},</span>
0042 <span class="comment">%       Author       = {Tron, R. and Daniilidis, K.},</span>
0043 <span class="comment">%       Booktitle    = {IEEE Conference on Computer Vision and Pattern Recognition},</span>
0044 <span class="comment">%       Year         = {2014},</span>
0045 <span class="comment">%       Organization = {{IEEE CVPR}}</span>
0046 <span class="comment">%     }</span>
0047 
0048 
0049 <span class="comment">% This file is part of Manopt: www.manopt.org.</span>
0050 <span class="comment">% Original author: Roberto Tron, Aug. 8, 2014</span>
0051 <span class="comment">% Contributors: Bamdev Mishra, May 15, 2015.</span>
0052 <span class="comment">%</span>
0053 <span class="comment">%</span>
0054 <span class="comment">% RT: General implementation note: to streamline component-wise</span>
0055 <span class="comment">% computations, in tangentProjection and exponential,</span>
0056 <span class="comment">% we flatten out the arguments into [3 x 3 x 2K] arrays, compute the</span>
0057 <span class="comment">% components all together, and then sharp the result again into [3 x 6 x K]</span>
0058 <span class="comment">% arrays.</span>
0059 
0060 
0061     <span class="comment">% Optional parameters to switch between the signed and unsigned</span>
0062     <span class="comment">% versions of the manifold.</span>
0063     <span class="keyword">if</span> ~exist(<span class="string">'strSigned'</span>, <span class="string">'var'</span>) || isempty(strSigned)
0064         strSigned = <span class="string">'signed'</span>;
0065     <span class="keyword">end</span>
0066     <span class="keyword">switch</span>(strSigned)
0067         <span class="keyword">case</span> <span class="string">'signed'</span>
0068             flagSigned = true;
0069         <span class="keyword">case</span> <span class="string">'unsigned'</span>
0070             flagSigned = false;
0071         <span class="keyword">otherwise</span>
0072             error(<span class="string">'Second argument can be either empty, ''signed'', or ''unsigned''.'</span>);
0073     <span class="keyword">end</span>
0074 
0075     
0076     <span class="keyword">if</span> ~exist(<span class="string">'k'</span>, <span class="string">'var'</span>) || isempty(k)
0077         k = 1;
0078     <span class="keyword">end</span>
0079     
0080     <span class="keyword">if</span> k == 1
0081         M.name = @() sprintf(<span class="string">'Quotient representation of the essential manifold, %s'</span>, strSigned);
0082     <span class="keyword">elseif</span> k &gt; 1 &amp;&amp; k == round(k)
0083         M.name = @() sprintf(<span class="string">'Product of %d quotient representations of the essential manifold, %s'</span>, k, strSigned);
0084     <span class="keyword">else</span>
0085         error(<span class="string">'k must be an integer no less than 1.'</span>);
0086     <span class="keyword">end</span>
0087     
0088     M.dim = @() k*5;
0089     
0090     M.inner = @(x, d1, d2) d1(:).'*d2(:);
0091     
0092     M.norm = @(x, d) norm(d(:));
0093     
0094     M.typicaldist = @() pi*sqrt(2*k);
0095     
0096     M.proj = @<a href="#_sub1" class="code" title="subfunction HProjHoriz=tangentProjection(X,H)">tangentProjection</a>;
0097     <a name="_sub1" href="#_subfunctions" class="code">function HProjHoriz=tangentProjection(X,H)</a>
0098         <span class="comment">% Project H on the tangent space of SO(3)^2</span>
0099         HProj = <a href="essential_sharp.html" class="code" title="function H = essential_sharp(Hp)">essential_sharp</a>(<a href="../../../manopt/tools/multiskew.html" class="code" title="function Y = multiskew(X)">multiskew</a>(<a href="../../../manopt/tools/multiprod.html" class="code" title="function c = multiprod(a, b, idA, idB)">multiprod</a>(<a href="../../../manopt/tools/multitransp.html" class="code" title="function b = multitransp(a, dim)">multitransp</a>(<a href="essential_flat.html" class="code" title="function Hp = essential_flat(H)">essential_flat</a>(X)), <a href="essential_flat.html" class="code" title="function Hp = essential_flat(H)">essential_flat</a>(H))));
0100         
0101         <span class="comment">% Compute projection on vertical component</span>
0102         p = vertproj(X, HProj);
0103         
0104         HProjHoriz = HProj - <a href="../../../manopt/tools/multiprod.html" class="code" title="function c = multiprod(a, b, idA, idB)">multiprod</a>(p/2,[<a href="essential_hat3.html" class="code" title="function [V, vShift] = essential_hat3(v)">essential_hat3</a>(permute(X(3,1:3,:),[2 3 1])) <a href="essential_hat3.html" class="code" title="function [V, vShift] = essential_hat3(v)">essential_hat3</a>(permute(X(3,4:6,:),[2 3 1]))]);<span class="comment">% BM: okay</span>
0105     <span class="keyword">end</span>
0106     
0107     
0108     M.tangent = @(X, H) <a href="essential_sharp.html" class="code" title="function H = essential_sharp(Hp)">essential_sharp</a>(<a href="../../../manopt/tools/multiskew.html" class="code" title="function Y = multiskew(X)">multiskew</a>(<a href="essential_flat.html" class="code" title="function Hp = essential_flat(H)">essential_flat</a>(H)));
0109     
0110     M.egrad2rgrad=@<a href="#_sub2" class="code" title="subfunction rgrad = egrad2rgrad(X, egrad)">egrad2rgrad</a>;
0111     <a name="_sub2" href="#_subfunctions" class="code">function rgrad = egrad2rgrad(X, egrad)</a>
0112         rgrad = M.proj(X, egrad);
0113     <span class="keyword">end</span>
0114     
0115     M.ehess2rhess = @<a href="#_sub3" class="code" title="subfunction rhess = ehess2rhess(X, egrad, ehess, S)">ehess2rhess</a>;
0116     <a name="_sub3" href="#_subfunctions" class="code">function rhess = ehess2rhess(X, egrad, ehess, S)</a>
0117         <span class="comment">% Reminder: S contains skew-symmeric matrices. The actual</span>
0118         <span class="comment">% direction that the point X is moved along is X*S.</span>
0119         RA = p1(X);
0120         RB = p2(X);
0121         SA = p1(S);
0122         SB = p2(S);
0123         
0124         G = egrad; 
0125         GA = p1(G);
0126         GB = p2(G);
0127         
0128         H = ehess; 
0129         
0130         <span class="comment">% RT: We now compute the connection, i.e. the part of the derivative</span>
0131         <span class="comment">% given by the curvature of the space (as opposed to a simple</span>
0132         <span class="comment">% Euclidean derivative).</span>
0133         
0134         <span class="comment">% The following is the vectorized version of connection=-[multisym(GA'*RA)*SA multisym(GB'*RB)*SB];</span>
0135         connection = tangent2ambient(X,-cat(2,<span class="keyword">...</span>
0136             <a href="../../../manopt/tools/multiprod.html" class="code" title="function c = multiprod(a, b, idA, idB)">multiprod</a>(<a href="../../../manopt/tools/multisym.html" class="code" title="function Y = multisym(X)">multisym</a>(<a href="../../../manopt/tools/multiprod.html" class="code" title="function c = multiprod(a, b, idA, idB)">multiprod</a>(<a href="../../../manopt/tools/multitransp.html" class="code" title="function b = multitransp(a, dim)">multitransp</a>(GA), RA)), SA),<span class="keyword">...</span>
0137             <a href="../../../manopt/tools/multiprod.html" class="code" title="function c = multiprod(a, b, idA, idB)">multiprod</a>(<a href="../../../manopt/tools/multisym.html" class="code" title="function Y = multisym(X)">multisym</a>(<a href="../../../manopt/tools/multiprod.html" class="code" title="function c = multiprod(a, b, idA, idB)">multiprod</a>(<a href="../../../manopt/tools/multitransp.html" class="code" title="function b = multitransp(a, dim)">multitransp</a>(GB), RB)), SB)));
0138         rhess = M.proj(X,H + connection);
0139     <span class="keyword">end</span>
0140     
0141     
0142     
0143     M.exp = @<a href="#_sub4" class="code" title="subfunction Y = exponential(X, U, t)">exponential</a>;
0144     <a name="_sub4" href="#_subfunctions" class="code">function Y = exponential(X, U, t)</a>
0145         <span class="keyword">if</span> nargin == 3
0146             U = t*U;
0147         <span class="keyword">end</span>
0148         
0149         UFlat = <a href="essential_flat.html" class="code" title="function Hp = essential_flat(H)">essential_flat</a>(U);
0150         exptUFlat = <a href="#_sub11" class="code" title="subfunction R = rot3_exp(V)">rot3_exp</a>(UFlat);
0151         Y = <a href="essential_sharp.html" class="code" title="function H = essential_sharp(Hp)">essential_sharp</a>(<a href="../../../manopt/tools/multiprod.html" class="code" title="function c = multiprod(a, b, idA, idB)">multiprod</a>(<a href="essential_flat.html" class="code" title="function Hp = essential_flat(H)">essential_flat</a>(X), exptUFlat));
0152     <span class="keyword">end</span>
0153     
0154     M.retr = @<a href="#_sub4" class="code" title="subfunction Y = exponential(X, U, t)">exponential</a>;
0155     
0156     M.log = @<a href="#_sub5" class="code" title="subfunction U = logarithm(X, Y)">logarithm</a>; 
0157     <a name="_sub5" href="#_subfunctions" class="code">function U = logarithm(X, Y)</a>
0158         
0159         QX = [X(:,1:3,:);X(:,4:6,:)];
0160         QY = [Y(:,1:3,:);Y(:,4:6,:)];
0161         QYr = <a href="../../../manopt/manifolds/essential/privateessential/essential_closestRepresentative.html" class="code" title="function Q2r=essential_closestRepresentative(Q1,Q2,varargin)">essential_closestRepresentative</a>(QX,QY,<span class="string">'flagSigned'</span>,flagSigned);
0162         Yr = [QYr(1:3,:,:) QYr(4:6,:,:)];
0163         U = zeros(size(X));
0164         U(:,1:3,:) = <a href="#_sub12" class="code" title="subfunction V = rot3_log(R)">rot3_log</a>(<a href="../../../manopt/tools/multiprod.html" class="code" title="function c = multiprod(a, b, idA, idB)">multiprod</a>(<a href="../../../manopt/tools/multitransp.html" class="code" title="function b = multitransp(a, dim)">multitransp</a>(X(:,1:3,:)),Yr(:,1:3,:)));
0165         U(:,4:6,:) = <a href="#_sub12" class="code" title="subfunction V = rot3_log(R)">rot3_log</a>(<a href="../../../manopt/tools/multiprod.html" class="code" title="function c = multiprod(a, b, idA, idB)">multiprod</a>(<a href="../../../manopt/tools/multitransp.html" class="code" title="function b = multitransp(a, dim)">multitransp</a>(X(:,4:6,:)),Yr(:,4:6,:)));
0166     <span class="keyword">end</span>
0167     
0168     M.hash = @(X) [<span class="string">'z'</span> <a href="../../../manopt/tools/hashmd5.html" class="code" title="function h = hashmd5(inp)">hashmd5</a>(X(:))];
0169     
0170     M.rand = @() <a href="#_sub6" class="code" title="subfunction Q = randessential(N)">randessential</a>(k);
0171     <a name="_sub6" href="#_subfunctions" class="code">function Q = randessential(N)</a>
0172         <span class="comment">% Generates random essential matrices.</span>
0173         <span class="comment">%</span>
0174         <span class="comment">% function Q = randessential(N)</span>
0175         <span class="comment">%</span>
0176         <span class="comment">% Q is a [3x6] matrix where each [3x3] block is a uniformly distributed</span>
0177         <span class="comment">% matrix.</span>
0178         
0179         <span class="comment">% This file is part of Manopt: www.manopt.org.</span>
0180         <span class="comment">% Original author: Roberto Tron, Aug. 8, 2014</span>
0181         <span class="comment">% Contributors:</span>
0182         <span class="comment">% Change log:</span>
0183         
0184         <span class="keyword">if</span> nargin &lt; 1
0185             N = 1;
0186         <span class="keyword">end</span>
0187         
0188         Q = [<a href="../../../manopt/manifolds/rotations/randrot.html" class="code" title="function R = randrot(n, N)">randrot</a>(3,N) <a href="../../../manopt/manifolds/rotations/randrot.html" class="code" title="function R = randrot(n, N)">randrot</a>(3,N)];
0189     <span class="keyword">end</span>
0190     
0191     M.randvec = @<a href="#_sub7" class="code" title="subfunction U = randomvec(X)">randomvec</a>;
0192     <a name="_sub7" href="#_subfunctions" class="code">function U = randomvec(X)</a>
0193         U = <a href="#_sub1" class="code" title="subfunction HProjHoriz=tangentProjection(X,H)">tangentProjection</a>(X, <a href="essential_sharp.html" class="code" title="function H = essential_sharp(Hp)">essential_sharp</a>(<a href="../../../manopt/manifolds/rotations/randskew.html" class="code" title="function S = randskew(n, N)">randskew</a>(3, 2*k)));
0194         U = U / sqrt(M.inner([],U,U));
0195     <span class="keyword">end</span>
0196     
0197     M.lincomb = @<a href="../../../manopt/tools/matrixlincomb.html" class="code" title="function v = matrixlincomb(x, a1, d1, a2, d2) %#ok<INUSL>">matrixlincomb</a>;
0198     
0199     M.zerovec = @(x) zeros(3, 6, k);
0200     
0201     M.transp = @<a href="#_sub8" class="code" title="subfunction S2 = transport(X1, X2, S1)">transport</a>;
0202     <a name="_sub8" href="#_subfunctions" class="code">function S2 = transport(X1, X2, S1)</a>
0203         <span class="comment">% Transport a vector from the tangent space at X1 to the tangent</span>
0204         <span class="comment">% space at X2. This transport uses the left translation of the</span>
0205         <span class="comment">% ambient group and preserves the norm of S1. The left translation</span>
0206         <span class="comment">% aligns the vertical spaces at the two elements.</span>
0207         
0208         <span class="comment">% Group operation in the ambient group, X12=X2'*X1</span>
0209         X12 = <a href="essential_sharp.html" class="code" title="function H = essential_sharp(Hp)">essential_sharp</a>(<a href="../../../manopt/tools/multiprod.html" class="code" title="function c = multiprod(a, b, idA, idB)">multiprod</a>(<a href="../../../manopt/tools/multitransp.html" class="code" title="function b = multitransp(a, dim)">multitransp</a>(<a href="essential_flat.html" class="code" title="function Hp = essential_flat(H)">essential_flat</a>(X2)),<a href="essential_flat.html" class="code" title="function Hp = essential_flat(H)">essential_flat</a>(X1)));
0210         X12Flat = <a href="essential_flat.html" class="code" title="function Hp = essential_flat(H)">essential_flat</a>(X12);
0211         
0212         <span class="comment">% Left translation, S2=X12*S*X12'</span>
0213         S2 = <a href="essential_sharp.html" class="code" title="function H = essential_sharp(Hp)">essential_sharp</a>(<a href="../../../manopt/tools/multiprod.html" class="code" title="function c = multiprod(a, b, idA, idB)">multiprod</a>(X12Flat,<a href="../../../manopt/tools/multiprod.html" class="code" title="function c = multiprod(a, b, idA, idB)">multiprod</a>(<a href="essential_flat.html" class="code" title="function Hp = essential_flat(H)">essential_flat</a>(S1),<a href="../../../manopt/tools/multitransp.html" class="code" title="function b = multitransp(a, dim)">multitransp</a>(X12Flat))));
0214     <span class="keyword">end</span>
0215     
0216     M.pairmean = @<a href="#_sub9" class="code" title="subfunction Y = pairmean(X1, X2)">pairmean</a>;
0217     <a name="_sub9" href="#_subfunctions" class="code">function Y = pairmean(X1, X2)</a>
0218         V = M.log(X1, X2);
0219         Y = M.exp(X1, .5*V);
0220     <span class="keyword">end</span>
0221     
0222     M.dist = @(x, y) M.norm(x, M.log(x, y)); 
0223     
0224     M.vec = @(x, u_mat) u_mat(:);
0225     M.mat = @(x, u_vec) reshape(u_vec, [3, 6, k]);
0226     M.vecmatareisometries = @() true;
0227     
0228     
0229     
0230     p1 = @(X) X(:,1:3,:);
0231     p2 = @(X) X(:,4:6,:);
0232     
0233     
0234     vertproj = @(X,H) <a href="../../../manopt/tools/multiprod.html" class="code" title="function c = multiprod(a, b, idA, idB)">multiprod</a>(X(3,1:3,:),permute(<a href="#_sub10" class="code" title="subfunction v = vee3(V)">vee3</a>(H(:,1:3,:)),[1 3 2]))+<a href="../../../manopt/tools/multiprod.html" class="code" title="function c = multiprod(a, b, idA, idB)">multiprod</a>(X(3,4:6,:),permute(<a href="#_sub10" class="code" title="subfunction v = vee3(V)">vee3</a>(H(:,4:6,:)),[1 3 2]));
0235     
0236     tangent2ambient = @(X, H) <a href="essential_sharp.html" class="code" title="function H = essential_sharp(Hp)">essential_sharp</a>(<a href="../../../manopt/tools/multiprod.html" class="code" title="function c = multiprod(a, b, idA, idB)">multiprod</a>(<a href="essential_flat.html" class="code" title="function Hp = essential_flat(H)">essential_flat</a>(X), <a href="essential_flat.html" class="code" title="function Hp = essential_flat(H)">essential_flat</a>(H)));
0237     
0238     
0239 <span class="keyword">end</span>
0240 
0241 
0242 <span class="comment">%% Some functions used by the essential factory</span>
0243 
0244 <a name="_sub10" href="#_subfunctions" class="code">function v = vee3(V)</a>
0245     v = squeeze([V(3,2,:)-V(2,3,:); V(1,3,:)-V(3,1,:); V(2,1,:)-V(1,2,:)])/2;
0246 <span class="keyword">end</span>
0247 
0248 
0249 <span class="comment">% Compute the exponential map in SO(3) using Rodrigues' formula</span>
0250 <span class="comment">%  function R = rot3_exp(V)</span>
0251 <span class="comment">% V must be a [3x3xN] array of [3x3] skew-symmetric matrices.</span>
0252 <a name="_sub11" href="#_subfunctions" class="code">function R = rot3_exp(V)</a>
0253     v = <a href="#_sub10" class="code" title="subfunction v = vee3(V)">vee3</a>(V);
0254     nv = <a href="#_sub14" class="code" title="subfunction nv = cnorm(v)">cnorm</a>(v);
0255     idxZero = nv &lt; 1e-15;
0256     nvMod = nv;
0257     nvMod(idxZero) = 1;
0258     
0259     vNorm = v./([1;1;1]*nvMod);
0260     
0261     <span class="comment">% Matrix exponential using Rodrigues' formula</span>
0262     nv = shiftdim(nv,-1);
0263     c = cos(nv);
0264     s = sin(nv);
0265     [VNorm,vNormShift] = <a href="essential_hat3.html" class="code" title="function [V, vShift] = essential_hat3(v)">essential_hat3</a>(vNorm);
0266     vNormvNormT = <a href="../../../manopt/tools/multiprod.html" class="code" title="function c = multiprod(a, b, idA, idB)">multiprod</a>(vNormShift,<a href="../../../manopt/tools/multitransp.html" class="code" title="function b = multitransp(a, dim)">multitransp</a>(vNormShift));
0267     R=<a href="../../../manopt/tools/multiprod.html" class="code" title="function c = multiprod(a, b, idA, idB)">multiprod</a>(eye(3),c)+<a href="../../../manopt/tools/multiprod.html" class="code" title="function c = multiprod(a, b, idA, idB)">multiprod</a>(VNorm,s)+<a href="../../../manopt/tools/multiprod.html" class="code" title="function c = multiprod(a, b, idA, idB)">multiprod</a>(vNormvNormT,1-c);
0268 <span class="keyword">end</span>
0269 
0270 
0271 
0272 <span class="comment">% Compute the logarithm map in SO(3)</span>
0273 <span class="comment">%  function V = rot3_log(R)</span>
0274 <span class="comment">% V is a [3x3xN] array of [3x3] skew-symmetric matrices</span>
0275 <a name="_sub12" href="#_subfunctions" class="code">function V = rot3_log(R)</a>
0276     skewR = <a href="../../../manopt/tools/multiskew.html" class="code" title="function Y = multiskew(X)">multiskew</a>(R);
0277     ctheta = (<a href="../../../manopt/tools/multitrace.html" class="code" title="function tr = multitrace(A)">multitrace</a>(R)'-1)/2;
0278     stheta = <a href="#_sub14" class="code" title="subfunction nv = cnorm(v)">cnorm</a>(<a href="#_sub10" class="code" title="subfunction v = vee3(V)">vee3</a>(skewR));
0279     theta = atan2(stheta,ctheta);
0280     
0281     V=skewR;
0282     <span class="keyword">for</span> ik=1:size(R,3)
0283         V(:,:,ik)=V(:,:,ik)/<a href="#_sub13" class="code" title="subfunction sx = sincN(x)">sincN</a>(theta(ik));
0284     <span class="keyword">end</span>
0285 <span class="keyword">end</span>
0286 
0287 
0288 <a name="_sub13" href="#_subfunctions" class="code">function sx = sincN(x)</a>
0289     sx = sin(x)./x;
0290     sx(x==0) = 1;
0291 <span class="keyword">end</span>
0292 
0293 <a name="_sub14" href="#_subfunctions" class="code">function nv = cnorm(v)</a>
0294     nv = sqrt(sum(v.^2));
0295 <span class="keyword">end</span>
0296 
0297 
0298</pre></div>
<hr><address>Generated on Mon 06-Jul-2015 21:55:36 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>