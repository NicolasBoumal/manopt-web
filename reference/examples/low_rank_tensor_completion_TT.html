<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of low_rank_tensor_completion_TT</title>
  <meta name="keywords" content="low_rank_tensor_completion_TT">
  <meta name="description" content="Example file for the manifold encoded in fixedTTrankfactory.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">examples</a> &gt; low_rank_tensor_completion_TT.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for examples&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>low_rank_tensor_completion_TT
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>Example file for the manifold encoded in fixedTTrankfactory.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function low_rank_tensor_completion_TT() </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"> Example file for the manifold encoded in fixedTTrankfactory.

 The script runs a tensor completion task, where tensors are controlled
 by a low Tensor-Train rank. The factory fixedTTrankfactory rests heavily
 on TTeMPS 1.1 (slightly modified for Manopt), coded by M. Steinlechner.
 See manopt/manifolds/ttfixedrank/TTeMPS_1.1/ for license and installation
 instruction (in particular, certain MEX files may require compiling).

 This script generates results from figure 1 of the following paper:
   Michael Psenka and Nicolas Boumal
   Second-order optimization for tensors with fixed tensor-train rank
   NeurIPS OPT2020 workshop
   https://arxiv.org/abs/2011.13395

 See also: fixedTTrankfactory</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS/disp.html" class="code" title="function disp( x, name )">disp</a>	DISP Display TT/MPS tensor.</li><li><a href="../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS/norm.html" class="code" title="function res = norm( x, safe )">norm</a>	NORM Norm of a TT/MPS tensor.</li><li><a href="../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS/orthogonalize.html" class="code" title="function x = orthogonalize( x, pos )">orthogonalize</a>	ORTHOGONALIZE Orthogonalize tensor.</li><li><a href="../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS/round.html" class="code" title="function x = round( x, tol )">round</a>	ROUND Approximate TTeMPS tensor within a prescribed tolerance.</li><li><a href="../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS_block/disp.html" class="code" title="function disp( x, name )">disp</a>	DISP Display TT/MPS block-mu tensor.</li><li><a href="../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS_block/norm.html" class="code" title="function res = norm( x )">norm</a>	NORM Norm of a TT/MPS block-mu tensor.</li><li><a href="../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS_block/orthogonalize.html" class="code" title="function res = orthogonalize( x )">orthogonalize</a>	ORTHOGONALIZE Orthogonalize TT/MPS Block-mu tensor.</li><li><a href="../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS_block/round.html" class="code" title="function x = round( x, tol )">round</a>	ROUND Approximate TTeMPS tensor within a prescribed tolerance.</li><li><a href="../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS_op/disp.html" class="code" title="function disp( x, name )">disp</a>	DISP Display TT/MPS operator.</li><li><a href="../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS_op/round.html" class="code" title="function A = round(A, tol )">round</a>	ROUND Approximate TTeMPS operator within a prescribed tolerance.</li><li><a href="../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS_op_laplace/disp.html" class="code" title="function disp( x, name )">disp</a>	DISP Display TT/MPS operator.</li><li><a href="../manopt/manifolds/ttfixedrank/TTeMPS_1.1/TTeMPS_randn.html" class="code" title="function x = TTeMPS_randn(r, n)">TTeMPS_randn</a>	TTEMPS_RANDN Create random TTeMPS tensor</li><li><a href="../manopt/manifolds/ttfixedrank/TTeMPS_1.1/algorithms/completion/completion_als.html" class="code" title="function [X,cost,test,stats] = completion_als( A_Omega, Omega, A_Gamma, Gamma, X, opts )">completion_als</a>	ALS Completion</li><li><a href="../manopt/manifolds/ttfixedrank/TTeMPS_1.1/algorithms/completion/completion_orth.html" class="code" title="function [xL,cost,test,stats] = completion_orth( A_Omega, Omega, A_Gamma, Gamma, X, opts )">completion_orth</a>	RTTC: Riemannian Tensor Train Completion</li><li><a href="../manopt/manifolds/ttfixedrank/fixedTTrankfactory.html" class="code" title="function M = fixedTTrankfactory(n, r, ind)">fixedTTrankfactory</a>	Manifold of tensors of fixed Tensor Train (TT) rank, embedded geometry</li><li><a href="../manopt/solvers/trustregions/trustregions.html" class="code" title="function [x, cost, info, options] = trustregions(problem, x, options)">trustregions</a>	Riemannian trust-regions solver for optimization on manifolds.</li><li><a href="../manopt/tools/hessianspectrum.html" class="code" title="function lambdas = hessianspectrum(problem, x, usepreconstr, storedb, key)">hessianspectrum</a>	Returns the eigenvalues of the (preconditioned) Hessian at x.</li><li><a href="../manopt/tools/orthogonalize.html" class="code" title="function [Q, R] = orthogonalize(M, x, A)">orthogonalize</a>	Orthonormalizes a basis of tangent vectors in the Manopt framework.</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="#_sub1" class="code">function stats = test_cost_manopt(problem, x, stats)</a></li><li><a href="#_sub2" class="code">function c = eCostCompl(x, A, A0)</a></li><li><a href="#_sub3" class="code">function g = eGradCompl(x, A, A0)</a></li><li><a href="#_sub4" class="code">function h = eHessCompl(u, A0)</a></li><li><a href="#_sub5" class="code">function Omega = makeOmegaSet_local(n, sizeOmega, dist)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function low_rank_tensor_completion_TT()</a>
0002 <span class="comment">% Example file for the manifold encoded in fixedTTrankfactory.</span>
0003 <span class="comment">%</span>
0004 <span class="comment">% The script runs a tensor completion task, where tensors are controlled</span>
0005 <span class="comment">% by a low Tensor-Train rank. The factory fixedTTrankfactory rests heavily</span>
0006 <span class="comment">% on TTeMPS 1.1 (slightly modified for Manopt), coded by M. Steinlechner.</span>
0007 <span class="comment">% See manopt/manifolds/ttfixedrank/TTeMPS_1.1/ for license and installation</span>
0008 <span class="comment">% instruction (in particular, certain MEX files may require compiling).</span>
0009 <span class="comment">%</span>
0010 <span class="comment">% This script generates results from figure 1 of the following paper:</span>
0011 <span class="comment">%   Michael Psenka and Nicolas Boumal</span>
0012 <span class="comment">%   Second-order optimization for tensors with fixed tensor-train rank</span>
0013 <span class="comment">%   NeurIPS OPT2020 workshop</span>
0014 <span class="comment">%   https://arxiv.org/abs/2011.13395</span>
0015 <span class="comment">%</span>
0016 <span class="comment">% See also: fixedTTrankfactory</span>
0017 
0018 <span class="comment">% This file is part of Manopt and is copyrighted. See the license file.</span>
0019 <span class="comment">%</span>
0020 <span class="comment">% Main author: Michael Psenka, Jan. 6, 2021</span>
0021 <span class="comment">% Contributors: Nicolas Boumal</span>
0022 <span class="comment">%</span>
0023 <span class="comment">% Change log:</span>
0024 
0025 <span class="comment">% Set the random seed for reproducible results.</span>
0026 <span class="comment">% rng(15);</span>
0027 
0028 <span class="comment">% order of the tensors</span>
0029 d = 9;
0030 
0031 <span class="comment">% size vector of the tensors</span>
0032 nn = 4;
0033 n = nn * ones(1, d);
0034 
0035 <span class="comment">% set of ranks_ to test on. Each rank vector is of the form (1, r, ..., r, 1)</span>
0036 ranks_ = 3;
0037 <span class="comment">% set of omega to tensor size ratios we want to observe</span>
0038 omegaRatio_ = 0.1;
0039 
0040 prob_dist = [1 1 1 1];
0041 
0042 <span class="comment">% How many times should the experiments be run? Set to 10 in the paper.</span>
0043 count = 1;
0044 
0045 <span class="comment">% create a cell for storing final output tensors for each method.</span>
0046 <span class="comment">% Want number dependent on whether we vary the ranks or the omega ratios</span>
0047 finalTR_ = cell(1, count);
0048 
0049 finalRTTC_ = cell(1, count);
0050 finalALS_ = cell(1, count);
0051 
0052 <span class="comment">% cell for storing all targets (to test convergence at the end)</span>
0053 <span class="comment">% also tracking all omegas and gammas</span>
0054 
0055 targets_ = cell(1, count);
0056 omegas_ = cell(1, count);
0057 gammas_ = cell(1, count);
0058 
0059 <span class="comment">% We want different max inner iter for TR depending on how hard the problem is</span>
0060 maxInner_ = 10000;
0061 
0062 <span class="comment">% Specify max iter for RTTC at each test</span>
0063 maxIterRTTC_ = 5000;
0064 maxIterALS_ = 1000;
0065 
0066 <span class="comment">% set to true if you want to verify condition numbers</span>
0067 computeCondition = false;
0068 <span class="comment">% variable to store target Hessian condition numbers</span>
0069 cond_nums = [];
0070 
0071 <span class="keyword">for</span> p = 1:count
0072 
0073     rr = ranks_;
0074 
0075     r = [1, rr * ones(1, d - 1), 1];
0076     r(3:8) = ones(1, 6) * 5;
0077     r(4:7) = ones(1, 4) * 10;
0078     r(5:6) = ones(1, 2) * 10;
0079 
0080     rTarg = r;
0081 
0082     <span class="comment">% options for Steinlechner's algorithms, ALS and Riemannian respectively</span>
0083     opts = struct(<span class="string">'maxiter'</span>, maxIterALS_, <span class="string">'tol'</span>, 1e-14, <span class="string">'reltol'</span>, 0, <span class="string">'gradtol'</span>, 0);
0084     opts_tt = struct(<span class="string">'maxiter'</span>, maxIterRTTC_, <span class="string">'tol'</span>, 1e-14, <span class="string">'reltol'</span>, 0, <span class="string">'gradtol'</span>, 1e-8);
0085 
0086     <span class="comment">% set of observed points for tensor completion (Omega) and test set (Gamma)</span>
0087     <span class="comment">% test set used to make sure algorithms converge to the right tensor</span>
0088     sizeOmega = <a href="../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS/round.html" class="code" title="function x = round( x, tol )">round</a>(omegaRatio_ * prod(n));
0089 
0090     sizeGamma = sizeOmega;
0091 
0092     Omega = <a href="#_sub5" class="code" title="subfunction Omega = makeOmegaSet_local(n, sizeOmega, dist)">makeOmegaSet_local</a>(n, sizeOmega, prob_dist);
0093     Gamma = <a href="#_sub5" class="code" title="subfunction Omega = makeOmegaSet_local(n, sizeOmega, dist)">makeOmegaSet_local</a>(n, sizeGamma);
0094 
0095     omegas_{p} = Omega;
0096     gammas_{p} = Gamma;
0097 
0098     A = <a href="../manopt/manifolds/ttfixedrank/TTeMPS_1.1/TTeMPS_randn.html" class="code" title="function x = TTeMPS_randn(r, n)">TTeMPS_randn</a>(rTarg, n);
0099     targets_{p} = A;
0100 
0101     <span class="comment">% vector representing observed points of A at Omega and Gamma</span>
0102     A_Omega = A(Omega);
0103     A_Gamma = A(Gamma);
0104 
0105     <span class="comment">% Starting point for optimization. Forced to be unit norm</span>
0106     X0 = <a href="../manopt/manifolds/ttfixedrank/TTeMPS_1.1/TTeMPS_randn.html" class="code" title="function x = TTeMPS_randn(r, n)">TTeMPS_randn</a>(r, n);
0107     X0 = (1 / <a href="../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS/norm.html" class="code" title="function res = norm( x, safe )">norm</a>(X0)) * X0;
0108     X0 = <a href="../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS/orthogonalize.html" class="code" title="function x = orthogonalize( x, pos )">orthogonalize</a>(X0, X0.order);
0109 
0110     <span class="comment">% Construction of ManOpt factory for fixed-rank TT manifold</span>
0111     <span class="comment">% n is the dimension vector, r the rank vector, and Omega an optional</span>
0112     <span class="comment">% parameter to specify which points we observe on the manifold</span>
0113     TT = <a href="../manopt/manifolds/ttfixedrank/fixedTTrankfactory.html" class="code" title="function M = fixedTTrankfactory(n, r, ind)">fixedTTrankfactory</a>(n, r, Omega);
0114 
0115     <span class="comment">% checkmanifold(TT)</span>
0116 
0117     <a href="../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS/disp.html" class="code" title="function disp( x, name )">disp</a>(&quot;Oversampling ratio: &quot; + sizeOmega / TT.dim());
0118 
0119     <span class="comment">% Set up two problems: the normal tensor completion problem (problem)</span>
0120     <span class="comment">% and the same problem with L2 regularization (rProblem)</span>
0121     rProblem.M = TT;
0122     problem.M = TT;
0123 
0124     <span class="comment">% Setting up the original tensor competion problem for ManOpt</span>
0125     problem.cost = @(x) <a href="#_sub2" class="code" title="subfunction c = eCostCompl(x, A, A0)">eCostCompl</a>(x, A_Omega, Omega);
0126     problem.egrad = @(x) <a href="#_sub3" class="code" title="subfunction g = eGradCompl(x, A, A0)">eGradCompl</a>(x, A_Omega, Omega);
0127     problem.ehess = @(x, u) <a href="#_sub4" class="code" title="subfunction h = eHessCompl(u, A0)">eHessCompl</a>(u, Omega);
0128 
0129     <span class="comment">% computes the spectrum of the Hessian at current target point</span>
0130     <span class="keyword">if</span> computeCondition
0131         A_base = <a href="../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS/orthogonalize.html" class="code" title="function x = orthogonalize( x, pos )">orthogonalize</a>(A, A.order);
0132         spec = <a href="../manopt/tools/hessianspectrum.html" class="code" title="function lambdas = hessianspectrum(problem, x, usepreconstr, storedb, key)">hessianspectrum</a>(problem, A_base);
0133         cond_nums(end + 1) = spec(end) / spec(1);
0134     <span class="keyword">end</span>
0135 
0136     problem = rmfield(problem, <span class="string">'ehess'</span>);
0137 
0138     <span class="comment">% options for trust regions</span>
0139     options.Delta0 = 100;
0140     options.Delta_bar = 100 * 2^11;
0141     options.maxiter = 250;
0142     options.maxinner = maxInner_;
0143     options.maxtime = inf;
0144     options.tolgradnorm = 1e-8;
0145 
0146     <span class="comment">% setting up stats func for test cost</span>
0147     problem.Gamma = Gamma;
0148     problem.A_Gamma = A_Gamma;
0149     options.statsfun = @<a href="#_sub1" class="code" title="subfunction stats = test_cost_manopt(problem, x, stats)">test_cost_manopt</a>;
0150 
0151 
0152     <span class="comment">% Solve tensor completion problem w/ finite differences</span>
0153     [finalTR, cost_man_fd{p}, stats_man_fd{p}] = <a href="../manopt/solvers/trustregions/trustregions.html" class="code" title="function [x, cost, info, options] = trustregions(problem, x, options)">trustregions</a>(problem, X0, options);
0154 
0155     problem.ehess = @(x, u) <a href="#_sub4" class="code" title="subfunction h = eHessCompl(u, A0)">eHessCompl</a>(u, Omega);
0156     <span class="comment">% now solve with analytic hessian</span>
0157     [finalTR, cost_man{p}, stats_man{p}] = <a href="../manopt/solvers/trustregions/trustregions.html" class="code" title="function [x, cost, info, options] = trustregions(problem, x, options)">trustregions</a>(problem, X0, options);
0158 
0159     <span class="comment">% Final RTTC, slightly change parameters to allow lower gradient tolerance</span>
0160 
0161     [finalRTTC_{p}, cost_tt{p}, test_tt{p}, stats_tt{p}] = <span class="keyword">...</span>
0162         <a href="../manopt/manifolds/ttfixedrank/TTeMPS_1.1/algorithms/completion/completion_orth.html" class="code" title="function [xL,cost,test,stats] = completion_orth( A_Omega, Omega, A_Gamma, Gamma, X, opts )">completion_orth</a>(A_Omega, Omega, A_Gamma, Gamma, X0, opts_tt);
0163 
0164     <span class="comment">% ALS completion</span>
0165     [finalALS_{p}, cost_als{p}, test_als{p}, stats_als{p}] = <span class="keyword">...</span>
0166         <a href="../manopt/manifolds/ttfixedrank/TTeMPS_1.1/algorithms/completion/completion_als.html" class="code" title="function [X,cost,test,stats] = completion_als( A_Omega, Omega, A_Gamma, Gamma, X, opts )">completion_als</a>(A_Omega, Omega, A_Gamma, Gamma, X0, opts);
0167 
0168 <span class="keyword">end</span>
0169 
0170 <span class="comment">%%</span>
0171 l = lines(7);
0172 midred = l(<span class="keyword">end</span>, :);
0173 darkred = brighten(l(<span class="keyword">end</span>, :), -0.7);
0174 lightred = brighten(midred, 0.7);
0175 
0176 midblue = l(1, :);
0177 darkblue = brighten(midblue, -0.7);
0178 lightblue = brighten(midblue, 0.7);
0179 
0180 <span class="comment">% set alpha</span>
0181 lightred(end + 1) = 0.7;
0182 lightblue(end + 1) = 0.7;
0183 midred(end + 1) = 0.7;
0184 midblue(end + 1) = 0.7;
0185 
0186 figure;
0187 
0188 <span class="keyword">for</span> k = 1:count
0189     A = targets_{k};
0190     Omega = gammas_{k};
0191     A_Omega = A(Omega);
0192     semilogy([stats_man_fd{k}.time], sqrt(2 * [stats_man_fd{k}.cost_test]) / <a href="../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS/norm.html" class="code" title="function res = norm( x, safe )">norm</a>(A_Omega), <span class="string">'color'</span>, midred, <span class="string">'linewidth'</span>, 2)
0193     hold on
0194     semilogy([stats_man{k}.time], sqrt(2 * [stats_man{k}.cost_test]) / <a href="../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS/norm.html" class="code" title="function res = norm( x, safe )">norm</a>(A_Omega), <span class="string">'color'</span>, midblue, <span class="string">'linewidth'</span>, 2)
0195     semilogy(stats_tt{k}.time, test_tt{k}, <span class="string">'color'</span>, lightred, <span class="string">'linewidth'</span>, 2)
0196     semilogy(stats_als{k}.time, test_als{k}, <span class="string">'color'</span>, lightblue, <span class="string">'linewidth'</span>, 2)
0197 <span class="keyword">end</span>
0198 
0199 legend({<span class="string">'FD-TR'</span>, <span class="string">'RTR'</span>, <span class="string">'RTTC'</span>, <span class="string">'ALS'</span>})
0200 xlabel(<span class="string">'Time (s)'</span>)
0201 ylabel(<span class="string">'Test Cost'</span>)
0202 
0203 figure;
0204 
0205 <span class="keyword">for</span> k = 1:count
0206     A = targets_{k};
0207     Omega = omegas_{k};
0208     A_Omega = A(Omega);
0209     semilogy([stats_man_fd{k}.time], sqrt(2 * [stats_man_fd{k}.cost]) / <a href="../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS/norm.html" class="code" title="function res = norm( x, safe )">norm</a>(A_Omega), <span class="string">'color'</span>, midred, <span class="string">'linewidth'</span>, 2)
0210     hold on
0211     semilogy([stats_man{k}.time], sqrt(2 * [stats_man{k}.cost]) / <a href="../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS/norm.html" class="code" title="function res = norm( x, safe )">norm</a>(A_Omega), <span class="string">'color'</span>, midblue, <span class="string">'linewidth'</span>, 2)
0212     semilogy(stats_tt{k}.time, cost_tt{k}, <span class="string">'color'</span>, lightred, <span class="string">'linewidth'</span>, 2)
0213     semilogy(stats_als{k}.time, cost_als{k}, <span class="string">'color'</span>, lightblue, <span class="string">'linewidth'</span>, 2)
0214 <span class="keyword">end</span>
0215 
0216 legend({<span class="string">'FD-TR'</span>, <span class="string">'RTR'</span>, <span class="string">'RTTC'</span>, <span class="string">'ALS'</span>})
0217 xlabel(<span class="string">'Time (s)'</span>)
0218 ylabel(<span class="string">'Training Cost'</span>)
0219 
0220 
0221 figure;
0222 
0223 <span class="keyword">for</span> k = 1:count
0224     A = targets_{k};
0225     Omega = omegas_{k};
0226     A_Omega = A(Omega);
0227     semilogy([stats_man_fd{k}.time], [stats_man_fd{k}.gradnorm] / stats_tt{k}.gradnorm(1), <span class="string">'color'</span>, midred, <span class="string">'linewidth'</span>, 2)
0228     hold on
0229     semilogy([stats_man{k}.time], [stats_man{k}.gradnorm] / stats_tt{k}.gradnorm(1), <span class="string">'color'</span>, midblue, <span class="string">'linewidth'</span>, 2)
0230     semilogy(stats_tt{k}.time, (stats_tt{k}.gradnorm) / stats_tt{k}.gradnorm(1), <span class="string">'color'</span>, lightred, <span class="string">'linewidth'</span>, 2)
0231 <span class="keyword">end</span>
0232 
0233 legend({<span class="string">'FD-TR'</span>, <span class="string">'RTR'</span>, <span class="string">'RTTC'</span>})
0234 xlabel(<span class="string">'Time (s)'</span>)
0235 ylabel(<span class="string">'Gradient Norm'</span>)
0236 
0237 
0238 <span class="keyword">end</span>
0239 
0240 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%% Stats function %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0241 
0242 <a name="_sub1" href="#_subfunctions" class="code">function stats = test_cost_manopt(problem, x, stats)</a>
0243     stats.cost_test = .5 * <a href="../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS/norm.html" class="code" title="function res = norm( x, safe )">norm</a>(x(problem.Gamma) - problem.A_Gamma)^2;
0244 <span class="keyword">end</span>
0245 
0246 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%% FUNCTIONS FOR MANOPT TRUST REGIONS %%%%%%%%%%%%%%%%%%%%%%%%%</span>
0247 
0248 <span class="comment">% Non-regularized Euclidean functions</span>
0249 <a name="_sub2" href="#_subfunctions" class="code">function c = eCostCompl(x, A, A0)</a>
0250     c = .5 * <a href="../manopt/manifolds/ttfixedrank/TTeMPS_1.1/@TTeMPS/norm.html" class="code" title="function res = norm( x, safe )">norm</a>(x(A0) - A)^2;
0251 <span class="keyword">end</span>
0252 
0253 <a name="_sub3" href="#_subfunctions" class="code">function g = eGradCompl(x, A, A0)</a>
0254     g = (x(A0) - A);
0255 <span class="keyword">end</span>
0256 
0257 <a name="_sub4" href="#_subfunctions" class="code">function h = eHessCompl(u, A0)</a>
0258     uTT = tangent_to_TTeMPS(u);
0259     h = uTT(A0);
0260 <span class="keyword">end</span>
0261 
0262 <span class="comment">%%%%%%%%%%%%%%%% CUSTOM OMEGA SET GENERATOR, NON_UNIFORM DIST. %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0263 
0264 <span class="comment">% dist is given distribution for the integers. If none given, default to uniform</span>
0265 <a name="_sub5" href="#_subfunctions" class="code">function Omega = makeOmegaSet_local(n, sizeOmega, dist)</a>
0266 
0267     <span class="keyword">if</span> sizeOmega &gt; prod(n)
0268         error(<span class="string">'makeOmegaSet:sizeOmegaTooHigh'</span>, <span class="string">'Requested size of Omega is bigger than the tensor itself!'</span>)
0269     <span class="keyword">end</span>
0270 
0271     d = length(n);
0272     subs = zeros(sizeOmega, d);
0273 
0274     <span class="keyword">for</span> i = 1:d
0275 
0276         <span class="keyword">if</span> nargin == 2
0277             subs(:, i) = randi(n(i), sizeOmega, 1);
0278         <span class="keyword">else</span>
0279             subs(:, i) = randsample(n(i), sizeOmega, true, dist);
0280             <span class="comment">% for k = 1:sizeOmega</span>
0281             <span class="comment">%     subs(k,i) = randsample(n(i), sizeOmega, true, dist);</span>
0282 
0283         <span class="keyword">end</span>
0284 
0285     <span class="keyword">end</span>
0286 
0287     Omega = unique(subs, <span class="string">'rows'</span>);
0288     m = size(Omega, 1);
0289 
0290     <span class="keyword">while</span> m &lt; sizeOmega
0291         subs(1:m, :) = Omega;
0292 
0293         <span class="keyword">for</span> i = 1:d
0294 
0295             <span class="keyword">if</span> nargin == 2
0296                 subs(m + 1:sizeOmega, i) = randi(n(i), sizeOmega - m, 1);
0297             <span class="keyword">else</span>
0298                 subs(m + 1:sizeOmega, i) = randsample(n(i), sizeOmega - m, true, dist);
0299             <span class="keyword">end</span>
0300 
0301         <span class="keyword">end</span>
0302 
0303         Omega = unique(subs, <span class="string">'rows'</span>);
0304         m = size(Omega, 1);
0305     <span class="keyword">end</span>
0306 
0307 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Fri 30-Sep-2022 13:18:25 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>