<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Manopt - Helpful tools</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./icon.png" rel="icon" type="image/png">
<script src="site_libs/cookie-consent/cookie-consent.js"></script>
<link href="site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-71FCE8T97E"></script>

<script type="text/plain" cookie-consent="tracking">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-71FCE8T97E', { 'anonymize_ip': true});
</script>

<script type="text/javascript" charset="UTF-8">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({
  "notice_banner_type":"simple",
  "consent_type":"express",
  "palette":"light",
  "language":"en",
  "page_load_consent_levels":["strictly-necessary"],
  "notice_banner_reject_button_hide":false,
  "preferences_center_close_button_hide":false,
  "website_name":""
  });
});
</script> 
  
<style>html{ scroll-behavior: smooth; }</style>
<script>
window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      macros: {
        reals: "\\mathbb{R}",
        inner: ["\\left\\langle #1, #2 \\right\\rangle", 2],
        smallinner: ["\\langle #1, #2 \\rangle", 2],
        innersmall: ["\\langle #1, #2 \\rangle", 2],
        innerbig: ["\\big\\langle #1, #2 \\big\\rangle", 2],
        sqfrobnorm: ["\\left\\|#1\\right\\|_{\\mathrm{F}}^2", 1],
        sqfrobnormsmall: ["\\|#1\\|_{\\mathrm{F}}^2", 1],
        sqfrobnormbig: ["\\big\\|#1\\big\\|_{\\mathrm{F}}^2", 1],
        calM: "\\mathcal{M}",
        calN: "\\mathcal{N}",
        calA: "\\mathcal{A}",
        T: "\\mathrm{T}",
        skeww: "\\mathrm{skew}",
        symm: "\\mathrm{sym}",
        Sym: "\\mathrm{Sym}",
        Proj: "\\mathrm{Proj}",
        grad: "\\mathrm{grad}",
        Hess: "\\mathrm{Hess}",
        Retr: "\\mathrm{R}",
        D: "\\mathrm{D}",
        calE: "\\mathcal{E}",
        Stnp: "\\mathrm{St}(n,p)",
        Rnp: "\\mathbb{R}^{n \\times p}",
        Rmp: "\\mathbb{R}^{m \\times p}",
        Rnr: "\\mathbb{R}^{n \\times r}",
        Rrn: "\\mathbb{R}^{r \\times n}",
        Rmr: "\\mathbb{R}^{m \\times r}",
        Rnn: "\\mathbb{R}^{n \\times n}",
        Rmn: "\\mathbb{R}^{m \\times n}",
        Rpp: "\\mathbb{R}^{p \\times p}",
        Rmnr: "\\mathbb{R}^{m \\times n}_r",
        Rmnlr: "\\mathbb{R}^{m \\times n}_{\\leq r}",
        Rn: "\\mathbb{R}^{n}",
        Rm: "\\mathbb{R}^{m}",
        Rp: "\\mathbb{R}^{p}",
        Rd: "\\mathbb{R}^{d}",
        Rk: "\\mathbb{R}^{k}",
        Sn: "\\mathbb{S}^{n}",
        Sm: "\\mathbb{S}^{m}",
        Sd: "\\mathbb{S}^{d-1}",
        trace: "\\mathrm{Tr}",
        Trace: "\\mathrm{Tr}",
        diag: "\\mathrm{diag}",
        sign: "\\mathrm{sign}",
        Od: "\\mathrm{O}(d)",
        On: "\\mathrm{O}(n)",
        Om: "\\mathrm{O}(m)",
        SOd: "\\mathrm{SO}(d)",
        SOn: "\\mathrm{SO}(n)",
        rank: "\\mathrm{rank}",
        frakX: "\\mathfrak{X}",
        frakF: "\\mathfrak{F}",
        One: "\\mathbf{1}",
        dist: "\\mathrm{dist}",
        calP: "\\mathcal{P}",
        calK: "\\mathcal{K}",
        Rdd: "\\mathbb{R}^{d \\times d}",
        calU: "\\mathcal{U}",
        calV: "\\mathcal{V}",
        calW: "\\mathcal{W}",
        Exp: "\\mathrm{Exp}",
        Log: "\\mathrm{Log}",
        inj: "\\mathrm{inj}",
        dom: "\\operatorname{dom}",
        bigger: "<",
        dt: "\\mathrm{d}t",
        transpose: "^\\top\\! ",
        sigmamax: "\\sigma_{\\mathrm{max}}",
        sigmamin: "\\sigma_{\\mathrm{min}}",
        lambdamax: "\\lambda_{\\mathrm{max}}",
        lambdamin: "\\lambda_{\\mathrm{min}}",
        TODO: ["\\textcolor{red}{[\\textrm{#1}]}", 1]
      }
    },
    svg: {
      fontCache: 'global'
    }
  };
</script>

<script>
  window.addEventListener('load', function() {
    document.getElementById("cc-nb-title").innerHTML = "May we use cookies for anonymized analytics?";
    // to improve your browsing experience on our website, 
    document.getElementById("cc-nb-text").innerHTML = "We would like to use cookies to analyze our website traffic, and to understand where our visitors are coming from.";
  });
</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="Manopt - Helpful tools">
<meta property="og:description" content="">
<meta property="og:site-name" content="Manopt">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Manopt</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-tutorial" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Tutorial</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-tutorial">    
        <li>
    <a class="dropdown-item" href="./gettingstarted.html" rel="" target="">
 <span class="dropdown-text">Getting started</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./firstexample.html" rel="" target="">
 <span class="dropdown-text">A first example</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./manifolds.html" rel="" target="">
 <span class="dropdown-text">Manifolds</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./costdescription.html" rel="" target="">
 <span class="dropdown-text">Cost functions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./solvers.html" rel="" target="">
 <span class="dropdown-text">Solvers</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./tools.html" rel="" target="">
 <span class="dropdown-text">Helpful tools</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./core.html" rel="" target="">
 <span class="dropdown-text">Core tools</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="./learning.html" rel="" target="">
 <span class="menu-text">Learning</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./downloads.html" rel="" target="">
 <span class="menu-text">Downloads</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./forum.html" rel="" target="">
 <span class="menu-text">Forum</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/NicolasBoumal/manopt" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:manopttoolbox@gmail.com" rel="" target=""><i class="bi bi-envelope-at" role="img" aria-label="E-mail">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./tools.html">Helpful tools</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./gettingstarted.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting started</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./firstexample.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A first example</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./manifolds.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manifolds</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./costdescription.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Cost functions</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./solvers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Solvers</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tools.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Helpful tools</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./core.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core tools</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="2">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#checks-for-the-cost-function" id="toc-checks-for-the-cost-function" class="nav-link active" data-scroll-target="#checks-for-the-cost-function">Checks for the cost function</a>
  <ul class="collapse">
  <li><a href="#gradient-check" id="toc-gradient-check" class="nav-link" data-scroll-target="#gradient-check">Gradient check</a></li>
  <li><a href="#hessian-check" id="toc-hessian-check" class="nav-link" data-scroll-target="#hessian-check">Hessian check</a></li>
  </ul></li>
  <li><a href="#checks-for-manifolds" id="toc-checks-for-manifolds" class="nav-link" data-scroll-target="#checks-for-manifolds">Checks for manifolds</a></li>
  <li><a href="#eigenvalues-and-eigenvectors-of-the-hessian" id="toc-eigenvalues-and-eigenvectors-of-the-hessian" class="nav-link" data-scroll-target="#eigenvalues-and-eigenvectors-of-the-hessian">Eigenvalues and eigenvectors of the Hessian</a>
  <ul class="collapse">
  <li><a href="#via-matrix-representation" id="toc-via-matrix-representation" class="nav-link" data-scroll-target="#via-matrix-representation">Via matrix representation</a></li>
  <li><a href="#in-a-matrix-free-way" id="toc-in-a-matrix-free-way" class="nav-link" data-scroll-target="#in-a-matrix-free-way">In a matrix-free way</a></li>
  </ul></li>
  <li><a href="#finding-critical-points" id="toc-finding-critical-points" class="nav-link" data-scroll-target="#finding-critical-points">Finding critical points</a></li>
  <li><a href="#plotting-the-cost-function" id="toc-plotting-the-cost-function" class="nav-link" data-scroll-target="#plotting-the-cost-function">Plotting the cost function</a></li>
  <li><a href="#matrix-computations" id="toc-matrix-computations" class="nav-link" data-scroll-target="#matrix-computations">Matrix computations</a></li>
  <li><a href="#counters-to-track-computations" id="toc-counters-to-track-computations" class="nav-link" data-scroll-target="#counters-to-track-computations">Counters (to track computations)</a></li>
  <li><a href="#working-with-tangent-vectors" id="toc-working-with-tangent-vectors" class="nav-link" data-scroll-target="#working-with-tangent-vectors">Working with tangent vectors</a></li>
  <li><a href="#interactive-stopping-criteria" id="toc-interactive-stopping-criteria" class="nav-link" data-scroll-target="#interactive-stopping-criteria">Interactive stopping criteria</a></li>
  <li><a href="#utilities-for-solvers" id="toc-utilities-for-solvers" class="nav-link" data-scroll-target="#utilities-for-solvers">Utilities for solvers</a></li>
  <li><a href="#creating-manifolds" id="toc-creating-manifolds" class="nav-link" data-scroll-target="#creating-manifolds">Creating manifolds</a></li>
  <li><a href="#miscellaneous" id="toc-miscellaneous" class="nav-link" data-scroll-target="#miscellaneous">Miscellaneous</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Helpful tools</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>Manopt offers a suite of tools to help with studying a problem’s landscape, detecting bugs, speeding up computations, handling geometric objects, keeping track of computational efforts, etc. These are located in the folder <a href="https://github.com/NicolasBoumal/manopt/tree/master/manopt/tools">/manopt/tools</a>, and documented below.</p>
<section id="checks-for-the-cost-function" class="level2">
<h2 class="anchored" data-anchor-id="checks-for-the-cost-function">Checks for the cost function</h2>
<p>The cost function <span class="math inline">\(f\)</span> and its derivatives satisfy certain relationships. By checking these numerically, we can detect possible coding errors. Manopt provides tools to this effect:</p>
<ul>
<li><code>checkdiff(problem)</code> checks directional derivatives (<code>problem.diff</code> etc.)</li>
<li><code>checkgradient(problem)</code> checks the Riemannian gradient (<code>problem.egrad</code>, <code>problem.grad</code>, <code>problem.costgrad</code> etc.)</li>
<li><code>checkhessian(problem)</code> checks the Riemannian Hessian (<code>problem.ehess</code>, <code>problem.hess</code> etc.)</li>
</ul>
<p>The theory underlying these checks is explained in Sections 4.8 and 6.8 of <a href="https://www.nicolasboumal.net/book">this book</a>.</p>
<section id="gradient-check" class="level3">
<h3 class="anchored" data-anchor-id="gradient-check">Gradient check</h3>
<p>Pick a point <span class="math inline">\(x\)</span> on the manifold and a tangent vector <span class="math inline">\(u\)</span> at <span class="math inline">\(x\)</span>. From a truncated Taylor expansion, we know that the following holds with any retraction <span class="math inline">\(\Retr\)</span>: <span class="math display">\[
  E(t) = \Big| f(\Retr_x(tu)) - \big[ f(x) + t\cdot\D f(x)[u] \big] \Big| = \mathcal{O}(t^2).
\]</span> Hence, in a log-log plot with <span class="math inline">\(\log(t)\)</span> on the abscissa, the error should behave as <span class="math inline">\(\log(t^2) = 2\log(t)\)</span>. That is, we should observe a slope of 2. Calling <code>checkdiff(problem, x, u)</code> produces such a plot and reports the slope of it in a text output. Numerical errors prevent the curve to have a slope of 2 everywhere even if directional derivatives are correct, so you should really inspect the plot visually. If <code>x</code> and <code>u</code> are omitted, they are picked at random.</p>
<p>The Riemannian gradient is the (only) tangent vector field that satisfies <span class="math display">\[
  \inner{\grad f(x)}{u}_x = \D f(x)[u]
\]</span> for all <span class="math inline">\(x, u\)</span>. Calling <code>checkgradient(problem, x, u)</code> computes <span class="math inline">\(\grad f(x)\)</span> then does two things:</p>
<ol type="1">
<li>It runs <code>checkdiff(problem, x, u)</code> with <span class="math inline">\(\D f(x)[u]\)</span> replaced by <span class="math inline">\(\inner{\grad f(x)}{u}_x\)</span> in the expression for <span class="math inline">\(E(t)\)</span>: this outputs the slope plot and text.</li>
<li>It checks that the gradient is indeed a tangent vector, by reporting (as text) the norm of the difference between the gradient <code>gradfx</code> and the output of <code>problem.M.tangent(x, gradfx)</code>. This should be zero.</li>
</ol>
<p>If <code>x</code> and <code>u</code> are omitted, they are picked at random.</p>
</section>
<section id="hessian-check" class="level3">
<h3 class="anchored" data-anchor-id="hessian-check">Hessian check</h3>
<p>Going back to <span class="math inline">\(E(t)\)</span> and including the next term in the Taylor expansion, we know that <span class="math display">\[
  E(t) = \left| f(\Retr_x(tu)) - \left[ f(x) + t\cdot\D f(x)[u] + \frac{t^2}{2} \cdot \inner{u}{\Hess f(x)[u]}_x \right] \right| = \mathcal{O}(t^3)
\]</span> as long as one (or both) of the two conditions holds:</p>
<ol type="1">
<li>The retraction <span class="math inline">\(\Retr\)</span> is second order (see remarks below), or</li>
<li>The point <span class="math inline">\(x\)</span> is a critical point: <span class="math inline">\(\grad f(x) = 0\)</span>.</li>
</ol>
<p>Hence, in a log-log plot with <span class="math inline">\(\log(t)\)</span> on the abscissa, the error should behave as <span class="math inline">\(\log(t^3) = 3\log(t)\)</span>, i.e., we should observe a slope of 3. This tool produces such a plot and tries to compute the slope of it. Again, numerical errors prevent the curve to have a slope of 3 everywhere even if the derivatives are correct, so you should inspect the plot visually.</p>
<p>The tool also verifies that the Hessian indeed returns a tangent vector, in the same way that we checked above that the gradient is a tangent vector. This produces a text output.</p>
<p>The Hessian is a linear, symmetric operator from the tangent space at <span class="math inline">\(x\)</span> to itself. The tool generates two random scalars <span class="math inline">\(a_1, a_2\)</span> and two random tangent vectors <span class="math inline">\(u_1\)</span> and <span class="math inline">\(u_2\)</span> at <span class="math inline">\(x\)</span> to test linearity: <span class="math display">\[
  \Big\| a_1 \cdot \Hess f(x)[u_1] + a_2 \cdot \Hess f(x)[u_2] - \Hess f(x)[a_1 u_1 + a_2 u_2] \Big\|_x = 0.
\]</span> The quantity on the left-hand side is reported in text output, and should be zero up to machine precision.</p>
<p>To verify symmetry, the tool further computes the difference <span class="math display">\[
  \inner{\Hess f(x)[u_1]}{u_2}_x - \inner{u_1}{\Hess f(x)[u_2]}_x,
\]</span> which should also be zero.</p>
<p>If <code>x</code> and <code>u</code> are omitted, they are picked at random.</p>
<p>A couple of remarks:</p>
<ul>
<li>It is important to check <em>both</em> the slope test and the symmetry test. That is because <span class="math inline">\(\inner{u}{\Hess f(x)[u]}_x\)</span> only “sees” the symmetric part of <span class="math inline">\(\Hess f(x)\)</span>. If the code for the Hessian has a skew-symmetric part, then the Hessian is wrong, yet the slope test could succeed.</li>
<li>The tool <code>checkhessian</code> tries to use the exponential map <code>M.exp</code> by default (since this is a second-order retraction). If that is not available, the default retraction is used. It may be second order: read the <code>help</code> section of your manifold factory to confirm this. If it is not, then the slope test is inconclusive.</li>
</ul>
</section>
</section>
<section id="checks-for-manifolds" class="level2">
<h2 class="anchored" data-anchor-id="checks-for-manifolds">Checks for manifolds</h2>
<ul>
<li><p><code>checkretraction(M, x, v)</code> <br> For manifolds <code>M</code> which have a correct exponential map <code>M.exp</code> implemented, this tool produces a slopt-test plot to check the order of agreement of the retraction <code>M.retr</code> with the exponential. A slope of 2 indicates the retraction is a first-order approximation of the exponential (which is necessary for most (all?) convergence theorems to hold.) A slope of 3 indicates the retraction is second-order, which is convenient in some cases. The check is conducted at point <code>x</code> along direction <code>v</code>; they are generated at random if omitted.</p></li>
<li><p><code>checkmanifold(M)</code> <br> Runs a collection of tests on a manifold structure produced by a factory. The purpose of this tool is ease the process of creating factories for new manifolds. Contributions are welcome to extend it.</p></li>
</ul>
</section>
<section id="eigenvalues-and-eigenvectors-of-the-hessian" class="level2">
<h2 class="anchored" data-anchor-id="eigenvalues-and-eigenvectors-of-the-hessian">Eigenvalues and eigenvectors of the Hessian</h2>
<p>Given a function <span class="math inline">\(f \colon \calM \to \reals\)</span> and a point <span class="math inline">\(x \in \calM\)</span>, we may want to investigate the spectrum of <span class="math inline">\(\Hess f(x)\)</span>, that is, the Riemannian Hessian at <span class="math inline">\(x\)</span>. With a <code>problem</code> structure to describe <span class="math inline">\(f\)</span>, and <code>x</code> to identify the point <span class="math inline">\(x\)</span>, we can do so in several ways using the tools</p>
<ul>
<li><code>hessianmatrix</code> (then <code>eig</code>)</li>
<li><code>hessianspectrum</code> (internally via <code>eigs</code>)</li>
<li><code>hessianextreme</code> (via optimization)</li>
</ul>
<section id="via-matrix-representation" class="level3">
<h3 class="anchored" data-anchor-id="via-matrix-representation">Via matrix representation</h3>
<p>The first way is to obtain a representation of the Hessian as a matrix, then to compute the eigenvalues of that matrix. The one-line vesion goes as follows:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode matlab code-with-copy"><code class="sourceCode matlab"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="va">eig</span>(<span class="va">hessianmatrix</span>(<span class="va">problem</span><span class="op">,</span> <span class="va">x</span>)) <span class="co">% eigenvalues of Hess f(x)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>More explicitly: <span class="math inline">\(\Hess f(x)\)</span> is a symmetric linear map on the tangent space <span class="math inline">\(\T_x\calM\)</span>. If <span class="math inline">\(b_1, \ldots, b_k \in \T_x\calM\)</span> form an orthonormal basis for the tangent space, then the symmetric matrix <span class="math inline">\(H \in \reals^{k \times k}\)</span> with <span class="math display">\[H_{ij} = \inner{b_i}{\Hess f(x)[b_j]}_x\]</span> represents the Hessian in those coordinates, in the sense that if <span class="math inline">\(v = a_1 b_1 + \cdots + a_k b_k\)</span>, then <span class="math inline">\(\Hess f(x)[v] = c_1 b_1 + \cdots + c_k b_k\)</span> where <span class="math inline">\(c = Ha\)</span>. In particular, the eigenvalues of <span class="math inline">\(H\)</span> are the same as the eigenvalues of <span class="math inline">\(\Hess f(x)\)</span> because <span class="math inline">\(b_1, \ldots, b_k\)</span> are orthonormal.</p>
<p>If <code>hessianmatrix</code> is called without providing an orthonormal basis, then a basis is generated at random via <code>tangentorthobasis</code>. You can recover that basis too, as follows:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode matlab code-with-copy"><code class="sourceCode matlab"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>[<span class="va">H</span><span class="op">,</span> <span class="va">basis</span>] <span class="op">=</span> <span class="va">hessianmatrix</span>(<span class="va">problem</span><span class="op">,</span> <span class="va">x</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Then, <code>basis</code> is a cell such that <code>basis{1}, basis{2}, ...</code> form an orthonormal basis <span class="math inline">\(b_1, b_2, \ldots\)</span> for <span class="math inline">\(\T_x\calM\)</span>. This makes it possible to access the eigenvectors of <span class="math inline">\(\Hess f(x)\)</span> too, like so:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode matlab code-with-copy"><code class="sourceCode matlab"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>[<span class="va">H</span><span class="op">,</span> <span class="va">basis</span>] <span class="op">=</span> <span class="va">hessianmatrix</span>(<span class="va">problem</span><span class="op">,</span> <span class="va">x</span>)<span class="op">;</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>[<span class="va">V</span><span class="op">,</span> <span class="va">D</span>] <span class="op">=</span> <span class="va">eig</span>(<span class="va">H</span>)<span class="op">;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="va">v</span> <span class="op">=</span> <span class="va">lincomb</span>(<span class="va">problem</span>.<span class="va">M</span><span class="op">,</span> <span class="va">x</span><span class="op">,</span> <span class="va">basis</span><span class="op">,</span> <span class="va">V</span>(<span class="op">:,</span> <span class="fl">1</span>))<span class="op">;</span> <span class="co">% eigenvector for eigenvalue D(1, 1)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>That code:</p>
<ol type="1">
<li>generates an orthonormal basis for <span class="math inline">\(\T_x\calM\)</span> and computes the matrix <span class="math inline">\(H\)</span> which represents <span class="math inline">\(\Hess f(x)\)</span> in that basis with <code>hessianmatrix</code>,</li>
<li>determines the eigenvalues and eigenvectors of <span class="math inline">\(H\)</span> with <code>eig</code>, then</li>
<li>expands the first such eigenvector as a linear combination of the basis vectors with <code>lincomb</code>.</li>
</ol>
<p>The result is a tangent vector <span class="math inline">\(v\)</span> at <span class="math inline">\(x\)</span> which is an eigenvector of <span class="math inline">\(\Hess f(x)\)</span>. You can check this by comparing <code>v</code> with <code>getHessian(problem, x, v)</code>.</p>
<p>If you already have an orthonormal basis, you can use that one by calling</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode matlab code-with-copy"><code class="sourceCode matlab"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="va">H</span> <span class="op">=</span> <span class="va">hessianmatrix</span>(<span class="va">problem</span><span class="op">,</span> <span class="va">x</span><span class="op">,</span> <span class="va">basis</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If <code>basis</code> is an orthonormal basis for a <em>subspace</em> of the tangent space, then <code>H</code> is a matrix that represents the restriction of the Hessian to that subspace.</p>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
The matrix-way does not scale well
</div>
</div>
<div class="callout-body-container callout-body">
<p>Generating the orthonormal basis takes time. So does applying the Hessian to each basis vector. This is a convenient tool for prototyping and exploration, but expect performance to degrade as dimension increases.</p>
</div>
</div>
</section>
<section id="in-a-matrix-free-way" class="level3">
<h3 class="anchored" data-anchor-id="in-a-matrix-free-way">In a matrix-free way</h3>
<p>In contrast to the <code>hessianmatrix</code> tool, the <code>hessianspectrum</code> tool provides access to the eigenvalues of the Hessian without building a basis for the tangent vector (and therefore also without constructing a matrix representation of the Hessian). It relies on Matlab’s <code>eigs</code>. An additional advantage is that it also provides access to the spectrum of the preconditioned Hessian (if a preconditioner is included in the <code>problem</code> structure).</p>
<p>To compute the eigenvalues of the Hessian <span class="math inline">\(\Hess f(x)\)</span> at <span class="math inline">\(x\)</span> with this tool, call</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode matlab code-with-copy"><code class="sourceCode matlab"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="va">hessianspectrum</span>(<span class="va">problem</span><span class="op">,</span> <span class="va">x</span>) <span class="co">% eigenvalues of Hess f(x)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If a preconditioner <span class="math inline">\(\mathrm{Prec}\)</span> is specified in the problem structure and you call</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode matlab code-with-copy"><code class="sourceCode matlab"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="va">hessianspectrum</span>(<span class="va">problem</span><span class="op">,</span> <span class="va">x</span><span class="op">,</span> <span class="ss">'precon'</span>) <span class="co">% eigenvalues of preconditioned Hess f(x)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>then the eigenvalues of the preconditioned Hessian <span class="math inline">\(\Hess f(x) \circ \mathrm{Prec}(x)\)</span> are computed.</p>
<p>This function relies on <code>problem.M.vec</code> and <code>problem.M.mat</code> to pass the computations down to Matlab’s built-in <code>eigs</code> function. For the eigenvalue problem to remain symmetric in the column-vector representation domain, we need <code>M.vec</code> and <code>M.mat</code> to be orthonormal, i.e., isometries (see <code>matvecareisometries</code> in the <a href="./manifolds.html">manifold section</a>). If they are not isometries, computations may take longer.</p>
<p>Indeed, let <span class="math inline">\(G\)</span> denote the <code>M.vec</code> operator and let <span class="math inline">\(G^{-1}\)</span> represent the <code>M.mat</code> operator (on the appropriate domains). Let <span class="math inline">\(H\)</span> and <span class="math inline">\(P\)</span> denotes the Hessian and preconditioner at <span class="math inline">\(x\)</span> (with <span class="math inline">\(P\)</span> being identity if there is none). Then, <code>eigs</code> computes the spectrum of <span class="math inline">\(GHG^{-1}\)</span> or <span class="math inline">\(GHPG^{-1}\)</span>, which are identical to, respectively, the spectra of <span class="math inline">\(H\)</span> and <span class="math inline">\(HP\)</span>. This is only symmetric if there is no preconditioner and <span class="math inline">\(G^\top = G^{-1}\)</span>.</p>
<p>If a preconditioner is used, the symmetry of the eigenvalue problem is lost: <span class="math inline">\(H\)</span> and <span class="math inline">\(P\)</span> are symmetric, but <span class="math inline">\(HP\)</span> is not. If <code>M.vec</code> and <code>M.mat</code> are isometries and the dimension of the manifold is large, it may be useful to restore symmetry by giving this tool a function handle for the <em>square root</em> of the preconditioner, <span class="math inline">\(P^{1/2}\)</span> (optional). Then, <code>eigs</code> is given the problem of computing the spectrum of <span class="math inline">\(GP^{1/2}HP^{1/2}G^\top\)</span> (symmetric), which is equal to the spectrum of <span class="math inline">\(HP\)</span>. Typically, the square root of the preconditioner is given via <code>problem.sqrtprecon</code> (see <a href="./costdescription.html">cost description</a>).</p>
<p>This tool can be faster than <code>hessianmatrix</code>, but it still aims to compute all eigenvalues. If you only need to compute an eigenvector for the largest or smallest eigenvalue, try <code>hessianextreme</code> as follows:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode matlab code-with-copy"><code class="sourceCode matlab"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>[<span class="va">u_min</span><span class="op">,</span> <span class="va">lambda_min</span>] <span class="op">=</span> <span class="va">hessianextreme</span>(<span class="va">problem</span><span class="op">,</span> <span class="va">x</span><span class="op">,</span> <span class="ss">'min'</span>)<span class="op">;</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>[<span class="va">u_max</span><span class="op">,</span> <span class="va">lambda_max</span>] <span class="op">=</span> <span class="va">hessianextreme</span>(<span class="va">problem</span><span class="op">,</span> <span class="va">x</span><span class="op">,</span> <span class="ss">'max'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>These run a Manopt solver on the Rayleigh quotient over the unit sphere in the tangent space <span class="math inline">\(\T_x\calM\)</span>, aiming to compute (respectively) a minimizer and a maximizer. As such, this tool is not guaranteed to succeed, but it always provides an upperbound on the smallest eigenvalue and a lowerbound on the largest eigenvalue of <span class="math inline">\(\Hess f(x)\)</span>. Call <code>help hessianextreme</code> for more options.</p>
<p>Comments:</p>
<ul>
<li>At this time, <code>hessianspectrum</code> outputs the eigenvalues only. It does not provide access to the eigenvectors, though it could be modified to that effect. It could also be modified to call <code>eigs</code> in a way that targets only extreme eigenvalues.</li>
<li>Both <code>hessianspectrum</code> and <code>hessianextreme</code> accept <code>(storedb, key)</code> as optional inputs, to use the caching system.</li>
</ul>
</section>
</section>
<section id="finding-critical-points" class="level2">
<h2 class="anchored" data-anchor-id="finding-critical-points">Finding critical points</h2>
<p>When studying the landscape of an optimization problem, we may want to find critical points of <span class="math inline">\(f\)</span>, that is, points where the Riemannian gradient is zero. If <code>problem</code> is the structure that describes your manifold <span class="math inline">\(\calM\)</span> and cost function <span class="math inline">\(f\)</span> (with derivatives), call</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode matlab code-with-copy"><code class="sourceCode matlab"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="va">cp_problem</span> <span class="op">=</span> <span class="va">criticalpointfinder</span>(<span class="va">problem</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>to create a new problem structure. This one is on the same manifold <span class="math inline">\(\calM\)</span>, but with the cost function <span class="math display">\[
  g(x) = \frac{1}{2} \| \grad f(x) \|^2_x.
\]</span> The gradient of <span class="math inline">\(g\)</span> is computed via <span class="math inline">\(\grad g(x) = \Hess f(x)[\grad f(x)]\)</span>. An approximate Hessian can also be generated.</p>
<p>Evidently, the minimizers of <span class="math inline">\(g\)</span> are the critical points of <span class="math inline">\(f\)</span>. Thus, running a solver such as <code>x = trustregions(cp_problem)</code> could find a critical point of <span class="math inline">\(f\)</span>. This is not guaranteed to work because <span class="math inline">\(g\)</span> may have non-global local minima. Accordingly, it is best to run the solver many times from various random initial guesses, and to check the gradient norm. For example:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode matlab code-with-copy"><code class="sourceCode matlab"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">% first define the problem structure, then:</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="va">cp_problem</span> <span class="op">=</span> <span class="va">criticalpointfinder</span>(<span class="va">problem</span>)<span class="op">;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="va">nrepeats</span> <span class="op">=</span> <span class="fl">100</span><span class="op">;</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="va">points</span> <span class="op">=</span> <span class="va">cell</span>(<span class="va">nrepeats</span><span class="op">,</span> <span class="fl">1</span>)<span class="op">;</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="va">gradfnorms</span> <span class="op">=</span> <span class="va">inf</span>(<span class="va">nrepeats</span><span class="op">,</span> <span class="fl">1</span>)<span class="op">;</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="va">cp_options</span>.<span class="va">tolgradnorm</span> <span class="op">=</span> <span class="fl">1e-10</span><span class="op">;</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="kw">for</span> <span class="va">rep</span> <span class="op">=</span> <span class="fl">1</span> <span class="op">:</span> <span class="va">nrepeats</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="va">x</span> <span class="op">=</span> <span class="va">trustregions</span>(<span class="va">cp_problem</span><span class="op">,</span> []<span class="op">,</span> <span class="va">cp_options</span>)<span class="op">;</span> <span class="co">% random init</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="va">points</span>{<span class="va">rep</span>} <span class="op">=</span> <span class="va">x</span><span class="op">;</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="va">gradfnorms</span>(<span class="va">rep</span>) <span class="op">=</span> <span class="va">problem</span>.<span class="va">M</span>.<span class="va">norm</span>(<span class="va">x</span><span class="op">,</span> <span class="va">getGradient</span>(<span class="va">problem</span><span class="op">,</span> <span class="va">x</span>))<span class="op">;</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co">% Now check which points have a satisfactorily small gradient norm.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="plotting-the-cost-function" class="level2">
<h2 class="anchored" data-anchor-id="plotting-the-cost-function">Plotting the cost function</h2>
<ul>
<li><p><code>plotprofile(problem, x, d, t)</code> <br> Plots the cost function along a geodesic or a retraction path starting at <span class="math inline">\(x\)</span>, along direction <span class="math inline">\(d\)</span>. All inputs are optional except <code>problem</code>. See <code>help plotprofile</code> for more information.</p></li>
<li><p><code>surfprofile(problem, x, d1, d2, t1, t2)</code> <br> Plots the cost function, lifted and restricted to a 2-dimensional subspace of the tangent space at <span class="math inline">\(x\)</span>. All inputs are optional except <code>problem</code>. See <code>help surfprofile</code> for more information.</p></li>
</ul>
</section>
<section id="matrix-computations" class="level2">
<h2 class="anchored" data-anchor-id="matrix-computations">Matrix computations</h2>
<p>Manopt includes tools to facilitate certain matrix computations as listed in the first table below. They provide help to:</p>
<ul>
<li>differentiate matrix functions,</li>
<li>solve matrix equations, and</li>
<li>compute factorizations.</li>
</ul>
<table class="table-striped table">
<caption>Tools for matrix computations that sometimes come up when using Manopt.</caption>
<colgroup>
<col style="width: 25%">
<col style="width: 75%">
</colgroup>
<thead>
<tr class="header">
<th>Call</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>dfunm</code>, <code>dlogm</code>, <code>dexpm</code>, <code>dsqrtm</code></td>
<td>Fréchet derivatives of the (built-in) matrix functions, and their particularization to <code>logm</code>, <code>expm</code> and <code>sqrtm</code>. For example, the call <code>[A, B] = dexpm(X, Xdot)</code> outputs both <span class="math inline">\(A = \D\mathrm{exp}(X)[\dot X]\)</span> and <span class="math inline">\(B = \mathrm{exp}(X)\)</span>.</td>
</tr>
<tr class="even">
<td><code>lyapunov_symmetric</code></td>
<td>Tool to solve the Lyapunov matrix equation <span class="math inline">\(AX + XA = C\)</span> when <span class="math inline">\(A = A^*\)</span> (real symmetric or Hermitian). Can solve for more than one right-hand side at a time.</td>
</tr>
<tr class="odd">
<td><code>lyapunov_symmetric_eig</code></td>
<td>Same as <code>lyapunov_symmetric</code> but the user supplies the eigenvalue decomposition of <span class="math inline">\(A\)</span> instead of <span class="math inline">\(A\)</span>. This is more efficient if several systems with the same <span class="math inline">\(A\)</span> need to be solved, but the various right-hand sides are not all known at the same time.</td>
</tr>
<tr class="even">
<td><code>sylvester_nochecks</code></td>
<td>Solves the Sylvester equation <span class="math inline">\(AX + XB = C\)</span>, where <span class="math inline">\(A\)</span> is an m-by-m matrix, <span class="math inline">\(B\)</span> is an n-by-n matrix, and <span class="math inline">\(X\)</span> and <span class="math inline">\(C\)</span> are two m-by-n matrices. This is a stripped-down version of Matlab’s own <code>sylvester</code> function that bypasses any input checks. This is significantly faster for small m and n, which is often useful in Manopt.</td>
</tr>
<tr class="odd">
<td><code>qr_unique</code></td>
<td>Given <span class="math inline">\(A\)</span> with full columns rank, <code>Q = qr_unique(A)</code> computes <span class="math inline">\(Q\)</span> of the same size as <span class="math inline">\(A\)</span> such that <span class="math inline">\(A = QR\)</span>, <span class="math inline">\(Q\)</span> has orthonormal columns and <span class="math inline">\(R\)</span> is upper triangular with positive diagonal entries. This fully specifies <span class="math inline">\(Q\)</span>. (Matlab’s <code>[Q, ~] = qr(A, 0)</code> does not enforce positive diagonal entries of <span class="math inline">\(R\)</span> by default, losing the uniqueness property). This Q-factor is exactly what one would compute through Gram–Schmidt orthonormalization of the columns of <span class="math inline">\(A\)</span>, but it is computed differently. Works with 3D arrays (on each slice separately) and with both real and complex matrices.</td>
</tr>
</tbody>
</table>
<p>Moreover, it is often useful to apply the same operations to many matrices. For best performance, it is important to vectorize such computations (in order to exploit <a href="https://en.wikipedia.org/wiki/Single_instruction,_multiple_data">SIMD</a> features of processors). The table below list tools Manopt provides to do just that:</p>
<table class="table-striped table">
<caption>Tools to apply the same computations to many matrices without for-loop. This improves performance significantly.</caption>
<colgroup>
<col style="width: 25%">
<col style="width: 75%">
</colgroup>
<thead>
<tr class="header">
<th>Call</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>B = multiscale(scale, A)</code></td>
<td>For a 3D matrix <code>A</code> of size nxmxN and a vector <code>scale</code> of length N, outputs <code>B</code>: a 3D matrix of the same size as <code>A</code> such that <code>B(:, :, k) = scale(k) * A(:, :, k)</code> for each <code>k</code>.</td>
</tr>
<tr class="even">
<td><code>tr = multitrace(A)</code></td>
<td>For a 3D matrix <code>A</code> of size nxnxN, outputs a column vector <code>tr</code> of length N such that <code>tr(k) = trace(A(:, :, k))</code> for each <code>k</code>.</td>
</tr>
<tr class="odd">
<td><code>sq = multisqnorm(A)</code></td>
<td>For a 3D matrix <code>A</code> of size nxmxN, outputs a column vector <code>sq</code> of length N such that <code>sq(k) = norm(A(:, :, k), 'fro')^2</code> for each <code>k</code>.</td>
</tr>
<tr class="even">
<td><code>B = multitransp(A)</code></td>
<td>For a 3D matrix <code>A</code> of size nxmxN, outputs <code>B</code>, a 3D matrix of size mxnxN such that <code>B(:, :, k) = A(:, :, k).'</code> for each <code>k</code> (transpose).</td>
</tr>
<tr class="odd">
<td><code>B = multihconj(A)</code></td>
<td>For a 3D matrix <code>A</code> of size nxmxN, outputs <code>B</code>, a 3D matrix of size mxnxN such that <code>B(:, :, k) = A(:, :, k)'</code> for each <code>k</code> (conjugate transpose).</td>
</tr>
<tr class="even">
<td><code>C = multiprod(A, B)</code></td>
<td>For 3D matrices <code>A</code> of size nxpxN and <code>B</code> of size pxmxN, outputs <code>C</code>, a 3D matrix of size nxmxN such that <code>C(:, :, k) = A(:, :, k) * B(:, :, k)</code> for each <code>k</code>.</td>
</tr>
<tr class="odd">
<td><code>B = multiskew(A)</code></td>
<td>For a 3D matrix <code>A</code> of size nxnxN, outputs a 3D matrix <code>B</code> the same size as <code>A</code> such that each slice <code>B(:, :, i)</code> is the skew-symmetric part of the slice <code>A(:, :, i)</code>, that is, <code>(A(:, :, i)-A(:, :, i).')/2</code>.</td>
</tr>
<tr class="even">
<td><code>B = multiskewh(A)</code></td>
<td>For a 3D matrix <code>A</code> of size nxnxN, outputs a 3D matrix <code>B</code> the same size as <code>A</code> such that each slice <code>B(:, :, i)</code> is the Hermitian skew-symmetric part of the slice <code>A(:, :, i)</code>, that is, <code>(A(:, :, i)-A(:, :, i)')/2</code>.</td>
</tr>
<tr class="odd">
<td><code>B = multisym(A)</code></td>
<td>For a 3D matrix <code>A</code> of size nxnxN, outputs a 3D matrix <code>B</code> the same size as <code>A</code> such that each slice <code>B(:, :, i)</code> is the symmetric part of the slice <code>A(:, :, i)</code>, that is, <code>(A(:, :, i)+A(:, :, i).')/2</code>.</td>
</tr>
<tr class="even">
<td><code>B = multiherm(A)</code></td>
<td>For a 3D matrix <code>A</code> of size nxnxN, outputs a 3D matrix <code>B</code> the same size as <code>A</code> such that each slice <code>B(:, :, i)</code> is the Hermitian part of the slice <code>A(:, :, i)</code>, that is, <code>(A(:, :, i)+A(:, :, i)')/2</code>.</td>
</tr>
</tbody>
</table>
</section>
<section id="counters-to-track-computations" class="level2">
<h2 class="anchored" data-anchor-id="counters-to-track-computations">Counters (to track computations)</h2>
<p>Manopt counters provide a way to track all sorts of metrics, including function calls, time spent in specific parts of them, particular operations, etc. They are accessed via two tools:</p>
<ul>
<li><code>S = statscounters(names)</code> is used to register Manopt counters in <code>options.statsfun</code> via <code>statsfunhelper</code>.</li>
<li><code>incrementcounter(store, countername, increment)</code> increments a counter in a <code>store</code> or <code>storedb</code>.</li>
</ul>
<p>A basic usage would go as follows. See the <a href="./costdescription.html">cost description</a> page, especially the section about caching, for more information about how <code>store</code> and <code>prepare</code> are used here.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode matlab code-with-copy"><code class="sourceCode matlab"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="va">foo</span>()</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="va">n</span> <span class="op">=</span> <span class="fl">100</span><span class="op">;</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="va">A</span> <span class="op">=</span> <span class="va">randsym</span>(<span class="va">n</span>)<span class="op">;</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="va">problem</span>.<span class="va">M</span> <span class="op">=</span> <span class="va">spherefactory</span>(<span class="va">size</span>(<span class="va">A</span><span class="op">,</span> <span class="fl">1</span>))<span class="op">;</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="va">problem</span>.<span class="va">cost</span> <span class="op">=</span> <span class="op">@</span><span class="va">cost</span><span class="op">;</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="va">problem</span>.<span class="va">egrad</span> <span class="op">=</span> <span class="op">@</span><span class="va">egrad</span><span class="op">;</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="va">problem</span>.<span class="va">ehess</span> <span class="op">=</span> <span class="op">@</span><span class="va">ehess</span><span class="op">;</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">% List the names of counters we want the optimization algorithm to log.</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">% The fields in the structure stats are function handles: one for each</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">% counter. Before passing stats to statsfunhelper, we could add more</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">% fields to stats to log other things as well.</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">%</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">% Names of the counters (here, Aproducts and some_other_counter) are</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">% for us to choose: they only need to be valid structure field names.</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">% They need not have been defined in advance.</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>    <span class="va">stats</span> <span class="op">=</span> <span class="va">statscounters</span>({<span class="ss">'Aproducts'</span><span class="op">,</span> <span class="ss">'some_other_counter'</span>})<span class="op">;</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>    <span class="va">options</span>.<span class="va">statsfun</span> <span class="op">=</span> <span class="va">statsfunhelper</span>(<span class="va">stats</span>)<span class="op">;</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>    [<span class="va">x</span><span class="op">,</span> <span class="va">fx</span><span class="op">,</span> <span class="va">info</span>] <span class="op">=</span> <span class="va">trustregions</span>(<span class="va">problem</span><span class="op">,</span> []<span class="op">,</span> <span class="va">options</span>)<span class="op">;</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>    <span class="va">semilogy</span>([<span class="va">info</span>.<span class="va">Aproducts</span>]<span class="op">,</span> [<span class="va">info</span>.<span class="va">gradnorm</span>]<span class="op">,</span> <span class="ss">'.-'</span>)<span class="op">;</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>    <span class="va">xlabel</span>(<span class="ss">'Number of matrix-vector products with A'</span>)<span class="op">;</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>    <span class="va">ylabel</span>(<span class="ss">'Riemannian gradient norm'</span>)<span class="op">;</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>    <span class="co">% Below, we have the code for the cost function and its derivatives.</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>    <span class="co">% Everytime we use a matrix-vector product with A, we increment the</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>    <span class="co">% counter.</span></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="va">store</span> <span class="op">=</span> <span class="va">prepare</span>(<span class="va">x</span><span class="op">,</span> <span class="va">store</span>)</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="op">~</span><span class="va">isfield</span>(<span class="va">store</span><span class="op">,</span> <span class="ss">'Ax'</span>)</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>            <span class="va">store</span>.<span class="va">Ax</span> <span class="op">=</span> <span class="va">A</span><span class="op">*</span><span class="va">x</span><span class="op">;</span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>            <span class="va">store</span> <span class="op">=</span> <span class="va">incrementcounter</span>(<span class="va">store</span><span class="op">,</span> <span class="ss">'Aproducts'</span>)<span class="op">;</span></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>        <span class="kw">end</span></span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> [<span class="va">f</span><span class="op">,</span> <span class="va">store</span>] <span class="op">=</span> <span class="va">cost</span>(<span class="va">x</span><span class="op">,</span> <span class="va">store</span>)</span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>        <span class="va">store</span> <span class="op">=</span> <span class="va">prepare</span>(<span class="va">x</span><span class="op">,</span> <span class="va">store</span>)<span class="op">;</span></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>        <span class="va">Ax</span> <span class="op">=</span> <span class="va">store</span>.<span class="va">Ax</span><span class="op">;</span></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>        <span class="va">f</span> <span class="op">=</span> <span class="fl">.5</span><span class="op">*</span><span class="va">x</span><span class="op">'*</span><span class="va">Ax</span><span class="op">;</span></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> [<span class="va">g</span><span class="op">,</span> <span class="va">store</span>] <span class="op">=</span> <span class="va">egrad</span>(<span class="va">x</span><span class="op">,</span> <span class="va">store</span>)</span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>        <span class="va">store</span> <span class="op">=</span> <span class="va">prepare</span>(<span class="va">x</span><span class="op">,</span> <span class="va">store</span>)<span class="op">;</span></span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>        <span class="va">g</span> <span class="op">=</span> <span class="va">store</span>.<span class="va">Ax</span><span class="op">;</span></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> [<span class="va">h</span><span class="op">,</span> <span class="va">store</span>] <span class="op">=</span> <span class="va">ehess</span>(<span class="va">x</span><span class="op">,</span> <span class="va">u</span><span class="op">,</span> <span class="va">store</span>)</span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>        <span class="va">h</span> <span class="op">=</span> <span class="va">A</span><span class="op">*</span><span class="va">u</span><span class="op">;</span></span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>        <span class="va">store</span> <span class="op">=</span> <span class="va">incrementcounter</span>(<span class="va">store</span><span class="op">,</span> <span class="ss">'Aproducts'</span>)<span class="op">;</span></span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>By default, <code>incrementcounter</code> increments by 1. You may also specify the increment as the last input (it can be any <code>double</code> value, not necessarily integer or positive).</p>
<p>See the <a href="https://github.com/NicolasBoumal/manopt/blob/master/examples/using_counters.m">full working example</a> in the <a href="https://github.com/NicolasBoumal/manopt/blob/master/examples">/examples</a> folder to see how to:</p>
<ul>
<li>register more than one counter,</li>
<li>use counters in a stopping criterion,</li>
<li>run several solvers on the same problem and compare the metrics tracked by counters.</li>
</ul>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>Counter names (such as <code>'Aproducts'</code> in the example) must be valid names for structure fields. Essentially, this means they should be valid variable names (no spaces, do not start with a digit, etc.)</p>
</div>
</div>
</div>
</section>
<section id="working-with-tangent-vectors" class="level2">
<h2 class="anchored" data-anchor-id="working-with-tangent-vectors">Working with tangent vectors</h2>
<p>The following tools ease certain tasks involving tangent spaces and tangent vectors.</p>
<ul>
<li><p><code>vec = lincomb(M, x, vectors, coeffs)</code> <br> Given a cell <code>vectors</code> of <span class="math inline">\(n\)</span> tangent vectors to the manifold <code>M</code> at <code>x</code> and a vector <code>coeffs</code> of <span class="math inline">\(n\)</span> real coefficients, outputs the linear combination of the given vectors with the given coefficients. The empty linear combination is the zero vector at <code>x</code>.</p></li>
<li><p><code>coeffs = tangent2vec(M, x, basis, u)</code> <br> Given a tangent vector <code>u</code> at <code>x</code> and an <em>orthonormal</em> basis <code>basis</code> for the corresponding tangent space, outputs the coordinates <code>coeffs</code> of <code>u</code> in that basis. The inverse operation is <code>u = lincomb(M, x, basis, coeffs)</code>, see above.</p></li>
<li><p><code>G = grammatrix(M, x, vectors)</code> <br> Given <span class="math inline">\(n\)</span> tangent vectors <span class="math inline">\(v_1, \ldots, v_n\)</span> to the manifold <code>M</code> at point <code>x</code> in a cell <code>vectors</code>, outputs a symmetric, positive semidefinite matrix <code>G</code> of size <span class="math inline">\(n\times n\)</span> such that <span class="math inline">\(G_{ij} = \inner{v_i}{v_j}_x\)</span>.</p></li>
<li><p><code>[orthobasis, L] = orthogonalize(M, x, basis)</code> <br> Given a cell <code>basis</code> which contains linearly independent tangent vectors to the manifold <code>M</code> at <code>x</code>, outputs an <em>orthonormal</em> basis of the subspace spanned by the given basis. <code>L</code> is an upper triangular matrix containing the coefficients of the linear combinations needed to transform <code>basis</code> into <code>orthobasis</code>. This is essentially a QR factorization, via modified Gram–Schmidt.</p></li>
<li><p><code>[orthobasis, L] = orthogonalizetwice(M, x, basis)</code> <br> Same as <code>orthogonalize</code>, but calls it twice in sequence for (much) improved numerical stability (at twice the computational cost).</p></li>
<li><p><code>obasis = tangentorthobasis(M, x, n)</code> <br> Given a point <code>x</code> on the manifold <code>M</code>, generates <code>n</code> unit-norm, pairwise orthogonal vectors in the tangent space to <code>M</code> at <code>x</code>, in a cell. See <code>help tangentorthobasis</code> for more advanced call patterns.</p></li>
<li><p><code>[u_norm, coeffs, u] = smallestinconvexhull(M, x, U)</code> <br> Computes <code>u</code>, a tangent vector to <code>M</code> at <code>x</code> contained in the convex hull spanned by the <span class="math inline">\(n\)</span> vectors in the cell <code>U</code>, with minimal norm (according to the Riemannian metric on <code>M</code>). This is obtained by solving a convex quadratic program involving the Gram matrix of the given tangent vectors. The quadratic program is solved using Matlab’s built-in <code>quadprog</code>, which requires the Optimization Toolbox.</p></li>
<li><p><code>[A, B1, B2] = operator2matrix(M1, x, y, F, B1, B2, M2)</code> <br> Given manifold structures <code>M1</code> and <code>M2</code>, two points <code>x</code> and <code>y</code> on these manifolds, and a function <code>F</code> encoding a linear operator from the tangent space <span class="math inline">\(\T_x \calM_1\)</span> to the tangent space <span class="math inline">\(\T_y \calM_2\)</span>, this tool uses two orthonormal bases <code>B1</code> and <code>B2</code> (one for <span class="math inline">\(\T_x \calM_1\)</span>, and one for <span class="math inline">\(\T_y \calM_2\)</span>; generated at random if omitted), and forms the matrix <code>A</code> which represents the operator <code>F</code> in those bases. In particular, the singular values of <code>A</code> are equal to the singular values of <code>F</code>. If <code>M2</code> is omitted, then <code>M2 = M1</code>. See the code for more use cases.</p></li>
</ul>
</section>
<section id="interactive-stopping-criteria" class="level2">
<h2 class="anchored" data-anchor-id="interactive-stopping-criteria">Interactive stopping criteria</h2>
<p>An interactive stopping criterion allows the user to stop the execution of a Manopt solver in real time. When it is triggered, the solver gracefully terminates and outputs the best iterate it produced so far. Matlab then proceeds to keep running the code that follows the call to the solver, so that the work done until that point is not lost.</p>
<p>One such tool open a special figure once the solver starts running. The solver terminates if the figure is closed.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode matlab code-with-copy"><code class="sourceCode matlab"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="va">options</span>.<span class="va">stopfun</span> <span class="op">=</span> <span class="op">@</span><span class="va">stopifclosedfigure</span><span class="op">;</span> <span class="co">% add this option</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="va">trustregions</span>(<span class="va">problem</span><span class="op">,</span> <span class="va">x0</span><span class="op">,</span> <span class="va">options</span>)<span class="op">;</span>    <span class="co">% run this or any other solver</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Another such tool (better suited if you are running Matlab without graphical user interface, e.g., over SSH) creates a special file. The solver terminates if that file is deleted.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode matlab code-with-copy"><code class="sourceCode matlab"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="va">options</span>.<span class="va">stopfun</span> <span class="op">=</span> <span class="va">stopifdeletedfile</span>()<span class="op">;</span> <span class="co">% add this option</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="va">trustregions</span>(<span class="va">problem</span><span class="op">,</span> <span class="va">x0</span><span class="op">,</span> <span class="va">options</span>)<span class="op">;</span>    <span class="co">% run this or any other solver</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>By default, the file is called <code>MANOPT_DELETE_ME_TO_STOP_SOLVER</code>. You may also specify another file name as optional input to <code>stopifdeletedfile</code>.</p>
<p>Note that termination may not be immediate as the solver has to finish the current iteration first. In particular, certain solvers (including <code>trustregions</code>) check stopping criteria only at outer iterations, not during inner iterations, further increasing the delay.</p>
</section>
<section id="utilities-for-solvers" class="level2">
<h2 class="anchored" data-anchor-id="utilities-for-solvers">Utilities for solvers</h2>
<ul>
<li><p><code>statsfunhelper</code> <br> Helper function to place a function handle in the field <code>options.statsfun</code>, with the purpose of recording or displaying information about individual iterations. See <a href="./solvers.html#statsfun-option-for-recording-info-at-each-iteration">this page</a> for documentation. Also consider using <code>statscounters</code> and <code>incrementcounter</code> as documented <a href="#counters-to-track-computations">on this page</a>.</p></li>
<li><p><code>manoptsolve</code> <br> This tool presents itself as a solver, with their usual calling pattern:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode matlab code-with-copy"><code class="sourceCode matlab"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>[<span class="va">x</span><span class="op">,</span> <span class="va">cost</span><span class="op">,</span> <span class="va">info</span><span class="op">,</span> <span class="va">options</span>] <span class="op">=</span> <span class="va">manoptsolve</span>(<span class="va">problem</span><span class="op">,</span> <span class="va">x0</span><span class="op">,</span> <span class="va">options</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>It is a gateway function to call an actual Manopt solver. You may specify which one to call by setting <code>options.solver</code> to a function handle corresponding to <a href="https://github.com/NicolasBoumal/manopt/tree/master/manopt/solvers">a solver</a>. For example,</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode matlab code-with-copy"><code class="sourceCode matlab"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="va">options</span>.<span class="va">solver</span> <span class="op">=</span> <span class="op">@</span><span class="va">trustregions</span><span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If not, a solver is picked automatically. This is mainly useful when programming meta algorithms which need to solve a Manopt problem, but one wants to leave the decision of which solver to use up to the final user (therefore making it an option).</p></li>
</ul>
</section>
<section id="creating-manifolds" class="level2">
<h2 class="anchored" data-anchor-id="creating-manifolds">Creating manifolds</h2>
<ul>
<li><p><code>productmanifold</code> and <code>powermanifold</code> <br> These tools generate a structure that represents a product of manifolds. See <a href="./manifolds.html#product-manifolds">this page</a> for documentation.</p></li>
<li><p><code>N = tangentspacefactory(M, x)</code> <br> Given a manifold structure <code>M</code> and a point <code>x</code> on that manifold, outputs a manifold structure <code>N</code> representing the tangent space to <code>M</code> at <code>x</code>. This is used in <a href="https://github.com/NicolasBoumal/manopt/blob/master/manopt/solvers/preconditioners/preconhessiansolve.m">preconhessiansolve</a>.</p></li>
<li><p><code>N = tangentspherefactory(M, x)</code> <br> Given a manifold structure <code>M</code> and a point <code>x</code> on that manifold, outputs a manifold structure <code>N</code> representing the unit sphere on the tangent space to <code>M</code> at <code>x</code>. This is used by the <a href="https://github.com/NicolasBoumal/manopt/blob/master/manopt/tools/hessianextreme.m">hessianextreme</a> tool.</p></li>
</ul>
</section>
<section id="miscellaneous" class="level2">
<h2 class="anchored" data-anchor-id="miscellaneous">Miscellaneous</h2>
<ul>
<li><p><code>y = sinxoverx(x)</code> <br> Computes <span class="math inline">\(y = \sin(x)/x\)</span>, with the convention <span class="math inline">\(\sin(0)/0 = 1\)</span>.</p></li>
<li><p><code>s = getsize(x)</code> <br> Estimates the memory usage of the input variable.</p></li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'alternate';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp("https:\/\/www\.manopt\.org");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
      }
    }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center"><div class="cookie-consent-footer"><a href="#" id="open_preferences_center">Cookie preferences -- it helps us to know which pages are read the most</a></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>



<script src="site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>